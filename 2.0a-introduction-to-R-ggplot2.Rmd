# Basic Introduction to R and ggplot

This is an introduction to R and ggplot2 that was created specificially for the UCMexus Conservation Genomics Workshop 2022.  The data used in this tutorial is a typical dataset used in ggplot.

## RStudio Layout

The RStudio layout is broken up into four panes: **Source**, **Console**, **Environment (history/connections)** and **Files (plots/packages/etc)**.  Within these panes there are additional tabs and we will go over the most important ones.  

```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/2.0_R_ggplot/RStudio.png")
```

The **Source** pane is where you can read, edit, and run your R code and the code can be saved as a *.R* file indicating it is an R script document.

```{r, echo=FALSE, out.width='75%'}
knitr::include_graphics("images/2.0_R_ggplot/Source.png")
```


An R document is written as a normal text document, however each line is a line of code in R.  However if you highlight a line and click **Run** (or type command-return), then the line of code will be executed and this activity will be displayed in the **Console**.

The **Console** pane is where the R code is executed and results are displayed, as well as other messages and warnings.

```{r, echo=FALSE, out.width='60%'}
knitr::include_graphics("images/2.0_R_ggplot/Console.png")
```
  
  
The **Environment** pane lists all available data and variables in the current session.  For example, in the example **Source** pane above I have a line of code `another_variable <- 5` which sets the string `another_variable` to represent the value 5.  After executing this line of code, the variable is stored and can be called at any point.  Once a variable has been created, it will be displayed in the **Environment**.  

*Note*: Whenever opening a script into a new session of R, you will need to re-run the lines of code you wish to use.  Opening a .R script does not automatically run the code.

```{r, echo=FALSE, out.width='75%'}
knitr::include_graphics("images/2.0_R_ggplot/Environment.png")
```

The **Files** pane is used to navigate through directories and can be used to open files directly into RStudio.  This will be useful when importing data into R.

```{r, echo=FALSE, out.width='60%'}
knitr::include_graphics("images/2.0_R_ggplot/Files.png")
```

Next to the **Files** tab, there is **Plots**.  In the example **Source** pane above I created a plot with the following code (*note*: the function `ggplot()` and the `mpg` dataset are from the `ggplot2` package that comes in the `tidyverse` package. You need to have `tidyverse` installed and loaded for this code to work on your console, this is addressed further down). 

```{r}
library(tidyverse)
library(ggplot2)
p <- ggplot(data = mpg) +
        geom_point(mapping = aes(x = displ, y = hwy))
p
```
  
When this code is executed, the resulting scatterplot is displayed below. If this was run in a R script rather than an Rmarkdown, the plot would be displayed in the *Plots* window.

Also useful is the **Help** tab for understanding what a function does.
    
##Data visualization with ggplot2
  
#Visualize
1. We want to understand our data and our analysis.
2. We want to produce graphics for publication and presentation.
    • We want to create plots quickly and get many things “for free”.
    • We want many options to customize and make things look awesome.

#ggplot2
ggplot2 uses the basic units of the “grammar of graphics” (Leland Wilkinson) to construct data visualizations in a layered approach.

The basic units in the “grammar of graphics” consist of:

 • The data or the actual information that is to be visualized.
 • The geometries, shortened to “geoms”, which describe the shapes that represent the data. These shapes can be dots on a scatter plot, bar charts on the graph, or a line to plot the data. Data are mapped to geoms.
 • The aesthetics, or the visual attributes of the plot, including the scales on the axes, the color, the fill, and other attributes concerning appearance

#Understanding the Ggplot Syntax
The syntax for constructing ggplots could be puzzling if you are a beginner or work primarily with base graphics. The main difference is that, unlike base graphics, ggplot works with dataframes and not individual vectors. All the data needed to make the plot is typically be contained within the dataframe supplied to the ggplot() itself or can be supplied to respective geoms. More on that later.

#A plot consists of components
The second noticeable feature is that you can keep enhancing the plot by adding more layers (and themes) to an existing plot created using the ggplot() function
  
#Verbose definition of a simple plot

```{r}
ggplot() +
  layer(data = mtcars,
      mapping = aes(x = hp, y = qsec),
      geom = 'point',
      stat = 'identity',
      position = 'identity') +
  scale_y_continuous() +
  scale_x_continuous() +
  coord_cartesian() +
  facet_null() +
  theme_grey()+
  theme(aspect.ratio = 1)
```
Ok, let's break this down.

```{r}
ggplot() +
### <b>
  layer(data = mtcars, #1
      mapping = aes(x = hp, y = qsec), #2
      geom = 'point', #3
      stat = 'identity', #4
      position = 'identity') + #5
### </b>
  theme(aspect.ratio = 1)
```

#1: Data

<b>layer(data = mtcars, #1 </b>
  mapping = aes(x = hp, y = qsec), #2
  geom = 'point', #3
  stat = 'identity', #4
  position = 'identity') + #5

  • A data layer needs data to display.
  • data is a data.frame or tibble if you are using tidyverse

```{r}
mtcars
msleep
iris
```

#2: What is a mapping?

layer(data = mtcars, #1
    <b> mapping = aes(x = hp, y = qsec), #2</b>
    geom = 'point', #3
    stat = 'identity', #4
    position = 'identity') + #5


  • An aesthetic mapping connects your data to your plot. (e.g. x, y, color, shape, alpha, size, linetype, etc.)
  • Aesthetics are “things that we can perceive on the graphic”.
  • We use the aes() function to create this mapping.
  • aes(aesthetic = variable)
  • Never use $! So never aes(x = mtcars$mpg)!

aes(x = hp, y = qsec)

Here, we are mapping hp on the x-axis and qsec on the y-axis.

#3: What is a geom?

layer(data = mtcars, #1
    mapping = aes(x = hp, y = qsec), #2
    <b> geom = 'point', #3 </b>
    stat = 'identity', #4
    position = 'identity') + #5

Simply the geometrical shape that you want to do draw.
  • 0d: point, text,
  • 1d: path, line (ordered path),
  • 2d: polygon, interval, boxplot etc.
  • geoms translate the aesthetics into an actual plot.

Geoms determine what aesthetics you need, and which you can use! (e.g. points cannot display the linetype aesthetic.)
  
Which aesthetics you need/can use is usually obvious, but is also clearly documented.
  
#Simplifying the code
Instead of writing out the whole layer(), we can use geom_*() functions to create the layer for us. These functions use common defaults.

We simply write:

```{r}
ggplot() +
geom_point(mapping = aes(x = hp, y = qsec), data = mtcars) +
  theme(aspect.ratio = 1)
```
  
Or, using positional matching:

```{r}
ggplot() + geom_point(aes(hp, qsec), mtcars)+
  theme(aspect.ratio = 1)
```

Like geom_point(), there are many such geom layers which we will see in a subsequent part in this tutorial series. For now, let’s just add a smoothing layer using geom_smooth(method='lm'). Since the method is set as lm (short for linear model), it draws the line of best fit.

#How would you change the color?
```{r}
g<-ggplot() +
  geom_point(aes(hp, qsec, color = mpg), mtcars) +  theme(aspect.ratio = 1) 
+ geom_smooth(method="lm")  # set se=FALSE to turnoff confidence bands

plot(g)
```

#How would you change color of the points?
```{r}
ggplot() +
geom_point(aes(hp, qsec, color = mpg), mtcars)+
  theme(aspect.ratio = 1)
```

#Continious versus discrete variables
R treats continuous and discrete information differently
ggplot directly uses this information to figure out how to best display data.
The class of the variable is used:
In this case, it checks:
```{r}
class(mtcars$cyl)
```

For it to recognized as a category (with fitting colors) we need a factor:
```{r}
class(factor(mtcars$cyl))
```

Character strings are silently converted to factors:
```{r}
ggplot() +
geom_point(aes(hp, qsec, color = as.character(cyl)), mtcars) +
labs(color = 'cyl')
```


• Some more on stats.
• Scales.
• Coordinate systems (brief).
• Facets.
• Themes.
• Plotting model fits.
• Some more challenges.
#Two special stats: stat_smooth
```{r}
ggplot(mtcars, aes(x = hp, y = qsec)) +
geom_point() +
geom_smooth()
```
 `geom_smooth()` using method = 'loess' and formula 'y ~ x'

Note, the code above would only change the color of the point layer, it would not affect the color of the smooth layer since the aes() aesthetic mapping is passed at the point layer.


