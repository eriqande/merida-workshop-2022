<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Session 6 Handling and Visualizing Spatial Data in R | Reproducible Research for Conservation — Mérida, Mexico</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Session 6 Handling and Visualizing Spatial Data in R | Reproducible Research for Conservation — Mérida, Mexico" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Session 6 Handling and Visualizing Spatial Data in R | Reproducible Research for Conservation — Mérida, Mexico" />
  
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Eric C. Anderson, Christen Bossu, Richard Evan Feldman, Kristen C. Ruegg, Marius Somveille" />


<meta name="date" content="2022-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="envdata.html"/>
<link rel="next" href="geassoc.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mérida Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setting-computer"><i class="fa fa-check"></i><b>0.1</b> Setting up your computer</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#step-1.-get-the-latest-versions-of-r-and-rstudio"><i class="fa fa-check"></i><b>0.1.1</b> Step 1. Get the latest versions of R and RStudio</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#step-2.-install-a-number-of-r-packages-that-are-relatively-easy-to-install"><i class="fa fa-check"></i><b>0.1.2</b> Step 2. Install a number of R packages that are relatively easy to install</a></li>
<li class="chapter" data-level="0.1.3" data-path="index.html"><a href="index.html#step-3.-make-sure-you-have-git-and-an-account-on-github"><i class="fa fa-check"></i><b>0.1.3</b> Step 3. Make sure you have git and an account on GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="congen-intro.html"><a href="congen-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Conservation Genomics Approaches</a>
<ul>
<li class="chapter" data-level="1.1" data-path="congen-intro.html"><a href="congen-intro.html#breakout-room-activity-material"><i class="fa fa-check"></i><b>1.1</b> Breakout room activity material</a></li>
<li class="chapter" data-level="1.2" data-path="congen-intro.html"><a href="congen-intro.html#after-kristens-talk-and-the-activity-please-download-the-course-repository"><i class="fa fa-check"></i><b>1.2</b> After Kristen’s Talk and the activity please download the course repository</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html"><i class="fa fa-check"></i><b>2</b> Basic Introduction to R and <em>ggplot2</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#rstudio-layout"><i class="fa fa-check"></i><b>2.1</b> RStudio Layout</a></li>
<li class="chapter" data-level="2.2" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#data-visualization-with-ggplot2"><i class="fa fa-check"></i><b>2.2</b> Data visualization with ggplot2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#understanding-the-ggplot-syntax"><i class="fa fa-check"></i><b>2.2.1</b> Understanding the Ggplot Syntax</a></li>
<li class="chapter" data-level="2.2.2" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#a-plot-consists-of-components"><i class="fa fa-check"></i><b>2.2.2</b> A plot consists of components</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#conclusion"><i class="fa fa-check"></i><b>2.3</b> Conclusion</a></li>
<li class="chapter" data-level="2.4" data-path="basic-introduction-to-r-and-ggplot2.html"><a href="basic-introduction-to-r-and-ggplot2.html#appendix-1-exercise-answers"><i class="fa fa-check"></i><b>2.4</b> Appendix 1: Exercise Answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Introduction to the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#what-tidyverse"><i class="fa fa-check"></i><b>3.1</b> What on earth is the tidyerse?</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#an-example-data-set"><i class="fa fa-check"></i><b>3.2</b> An example data set</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#reading-data-in-the-tidyverse"><i class="fa fa-check"></i><b>3.3</b> Reading data in the tidyverse</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#a-word-on-tibbles"><i class="fa fa-check"></i><b>3.4</b> A word on tibbles</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#back-to-tidying-up-our-genotype-data"><i class="fa fa-check"></i><b>3.5</b> Back to “tidying” up our genotype data</a></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#what-the-heck-is-that-thingie"><i class="fa fa-check"></i><b>3.6</b> What the heck is that <code>%&gt;%</code> thingie?!</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#the-dplyr-package-the-heart-of-the-tidyverse"><i class="fa fa-check"></i><b>3.7</b> The ‘dplyr’ package: the heart of the tidyverse</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#non-standard-evaluation-nse-you-dont-wrap-column-names-in-quotation-marks"><i class="fa fa-check"></i><b>3.7.1</b> Non-standard Evaluation (NSE): You don’t wrap column names in quotation marks</a></li>
<li class="chapter" data-level="3.7.2" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#select-to-select-columns-of-a-tibble"><i class="fa fa-check"></i><b>3.7.2</b> <code>select()</code> to select columns of a tibble</a></li>
<li class="chapter" data-level="3.7.3" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#filter-to-retain-certain-rows"><i class="fa fa-check"></i><b>3.7.3</b> <code>filter()</code> to retain certain rows</a></li>
<li class="chapter" data-level="3.7.4" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#arrange-to-reorder-the-rows-of-the-tibble"><i class="fa fa-check"></i><b>3.7.4</b> <code>arrange()</code> to reorder the rows of the tibble</a></li>
<li class="chapter" data-level="3.7.5" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#mutate-to-create-new-columns"><i class="fa fa-check"></i><b>3.7.5</b> <code>mutate()</code> to create new columns</a></li>
<li class="chapter" data-level="3.7.6" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#compute-a-single-value-from-many-rows-summarise"><i class="fa fa-check"></i><b>3.7.6</b> Compute a single value from many rows: <code>summarise()</code></a></li>
<li class="chapter" data-level="3.7.7" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#group_by-to-operate-tidily-on-subsets-of-a-tibble"><i class="fa fa-check"></i><b>3.7.7</b> <code>group_by()</code> to operate tidily on subsets of a tibble</a></li>
<li class="chapter" data-level="3.7.8" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#joins"><i class="fa fa-check"></i><b>3.7.8</b> Joins</a></li>
<li class="chapter" data-level="3.7.9" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#wrap-up"><i class="fa fa-check"></i><b>3.7.9</b> Wrap Up</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#modeling-within-the-tidyverse"><i class="fa fa-check"></i><b>3.8</b> Modeling within the Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reporg.html"><a href="reporg.html"><i class="fa fa-check"></i><b>4</b> Organizing Research Projects for Reproducibility</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reporg.html"><a href="reporg.html#goals-for-this-session"><i class="fa fa-check"></i><b>4.1</b> Goals for this session</a></li>
<li class="chapter" data-level="4.2" data-path="reporg.html"><a href="reporg.html#why-do-this"><i class="fa fa-check"></i><b>4.2</b> Why do this?</a></li>
<li class="chapter" data-level="4.3" data-path="reporg.html"><a href="reporg.html#what-can-this-look-like"><i class="fa fa-check"></i><b>4.3</b> What can this look like?</a></li>
<li class="chapter" data-level="4.4" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-1-dont-save-your-r-workspace-and-then-reload-it"><i class="fa fa-check"></i><b>4.4</b> Reproducibility Edict #1: Don’t Save Your R Workspace and then Reload It</a></li>
<li class="chapter" data-level="4.5" data-path="reporg.html"><a href="reporg.html#paths-an-important-concept-for-reproducibility"><i class="fa fa-check"></i><b>4.5</b> Paths, an important concept for reproducibility</a></li>
<li class="chapter" data-level="4.6" data-path="reporg.html"><a href="reporg.html#the-working-directory"><i class="fa fa-check"></i><b>4.6</b> The Working Directory</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="reporg.html"><a href="reporg.html#a-hugely-important-point"><i class="fa fa-check"></i><b>4.6.1</b> A Hugely Important Point!</a></li>
<li class="chapter" data-level="4.6.2" data-path="reporg.html"><a href="reporg.html#skeletal-anatomy-of-an-rstudio-project"><i class="fa fa-check"></i><b>4.6.2</b> Skeletal anatomy of an RStudio Project</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-2-dont-change-directories-in-your-code"><i class="fa fa-check"></i><b>4.7</b> Reproducibility Edict #2: Don’t Change Directories in Your Code</a></li>
<li class="chapter" data-level="4.8" data-path="reporg.html"><a href="reporg.html#relative-paths"><i class="fa fa-check"></i><b>4.8</b> Relative Paths</a></li>
<li class="chapter" data-level="4.9" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-3-always-use-relative-paths-from-the-project-directory-to-files-inside-the-project-directory"><i class="fa fa-check"></i><b>4.9</b> Reproducibility Edict #3: Always Use Relative Paths from the Project Directory to Files <em>inside</em> the Project Directory</a></li>
<li class="chapter" data-level="4.10" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-4-put-data-files-into-a-data-directory"><i class="fa fa-check"></i><b>4.10</b> Reproducibility Edict #4: Put data files into a <code>data</code> directory</a></li>
<li class="chapter" data-level="4.11" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-5-write-analysis-scripts-as-.r-or-.rmd-files"><i class="fa fa-check"></i><b>4.11</b> Reproducibility Edict #5: Write Analysis Scripts as <code>.R</code> or <code>.Rmd</code> files</a></li>
<li class="chapter" data-level="4.12" data-path="reporg.html"><a href="reporg.html#download-an-example-project-to-play-with"><i class="fa fa-check"></i><b>4.12</b> Download an example project to play with</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="reporg.html"><a href="reporg.html#lets-have-a-moment"><i class="fa fa-check"></i><b>4.12.1</b> Let’s have a moment</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-6-write-your-code-with-style"><i class="fa fa-check"></i><b>4.13</b> Reproducibility Edict #6: Write your code with style!</a></li>
<li class="chapter" data-level="4.14" data-path="reporg.html"><a href="reporg.html#what-about-shared-data-sets"><i class="fa fa-check"></i><b>4.14</b> What About Shared Data Sets?</a></li>
<li class="chapter" data-level="4.15" data-path="reporg.html"><a href="reporg.html#reproducibility-edict-7-use-git-for-version-control"><i class="fa fa-check"></i><b>4.15</b> Reproducibility Edict #7: Use git for Version Control</a></li>
<li class="chapter" data-level="4.16" data-path="reporg.html"><a href="reporg.html#in-the-meantime-a-short-demo-of-gitgithub-on-rstudio"><i class="fa fa-check"></i><b>4.16</b> In the meantime, a short demo of git/GitHub on RStudio</a></li>
<li class="chapter" data-level="4.17" data-path="reporg.html"><a href="reporg.html#what-to-keep-under-version-control-and-what-not-to"><i class="fa fa-check"></i><b>4.17</b> What to keep under version control and what not to</a></li>
<li class="chapter" data-level="4.18" data-path="reporg.html"><a href="reporg.html#create-a-readme-to-describe-the-parts-of-your-analysis-project"><i class="fa fa-check"></i><b>4.18</b> Create a README to describe the parts of your analysis project</a></li>
<li class="chapter" data-level="4.19" data-path="reporg.html"><a href="reporg.html#github-and-very-large-data-sets"><i class="fa fa-check"></i><b>4.19</b> GitHub and Very large data sets</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="envdata.html"><a href="envdata.html"><i class="fa fa-check"></i><b>5</b> Finding and Obtaining Environmental Data for Conservation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="envdata.html"><a href="envdata.html#environmental-layers.-a-general-overview"><i class="fa fa-check"></i><b>5.1</b> Environmental Layers. A general overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="envdata.html"><a href="envdata.html#environmental-layers-in-conservation-genetics"><i class="fa fa-check"></i><b>5.1.1</b> Environmental layers in conservation genetics</a></li>
<li class="chapter" data-level="5.1.2" data-path="envdata.html"><a href="envdata.html#examples-of-atmospheric-layers"><i class="fa fa-check"></i><b>5.1.2</b> Examples of atmospheric layers</a></li>
<li class="chapter" data-level="5.1.3" data-path="envdata.html"><a href="envdata.html#examples-of-vegetation-layers"><i class="fa fa-check"></i><b>5.1.3</b> Examples of vegetation layers</a></li>
<li class="chapter" data-level="5.1.4" data-path="envdata.html"><a href="envdata.html#examples-of-landscape-layers"><i class="fa fa-check"></i><b>5.1.4</b> Examples of landscape layers</a></li>
<li class="chapter" data-level="5.1.5" data-path="envdata.html"><a href="envdata.html#mariuss-links"><i class="fa fa-check"></i><b>5.1.5</b> Marius’s links</a></li>
<li class="chapter" data-level="5.1.6" data-path="envdata.html"><a href="envdata.html#example-code"><i class="fa fa-check"></i><b>5.1.6</b> Example Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatdata.html"><a href="spatdata.html"><i class="fa fa-check"></i><b>6</b> Handling and Visualizing Spatial Data in R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatdata.html"><a href="spatdata.html#handling-spatial-rasters-in-r"><i class="fa fa-check"></i><b>6.1</b> Handling Spatial Rasters in R</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="spatdata.html"><a href="spatdata.html#reading-and-printing-raster-data"><i class="fa fa-check"></i><b>6.1.1</b> Reading and Printing Raster Data</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatdata.html"><a href="spatdata.html#plotting-raster-data-with-plot"><i class="fa fa-check"></i><b>6.1.2</b> Plotting Raster Data with <code>plot()</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="spatdata.html"><a href="spatdata.html#plotting-raster-data-with-ggplot2"><i class="fa fa-check"></i><b>6.1.3</b> Plotting raster data with ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatdata.html"><a href="spatdata.html#vector-spatial-data"><i class="fa fa-check"></i><b>6.2</b> Vector Spatial Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="spatdata.html"><a href="spatdata.html#vector-data-features"><i class="fa fa-check"></i><b>6.2.1</b> Vector data features</a></li>
<li class="chapter" data-level="6.2.2" data-path="spatdata.html"><a href="spatdata.html#shapefiles"><i class="fa fa-check"></i><b>6.2.2</b> Shapefiles</a></li>
<li class="chapter" data-level="6.2.3" data-path="spatdata.html"><a href="spatdata.html#spatial-vector-data-in-r"><i class="fa fa-check"></i><b>6.2.3</b> Spatial vector data in R</a></li>
<li class="chapter" data-level="6.2.4" data-path="spatdata.html"><a href="spatdata.html#an-example-mexican-states"><i class="fa fa-check"></i><b>6.2.4</b> An example: Mexican states</a></li>
<li class="chapter" data-level="6.2.5" data-path="spatdata.html"><a href="spatdata.html#plotting-simple-features-with-ggplot"><i class="fa fa-check"></i><b>6.2.5</b> Plotting simple features with <code>ggplot()</code></a></li>
<li class="chapter" data-level="6.2.6" data-path="spatdata.html"><a href="spatdata.html#a-word-about-coord_sf"><i class="fa fa-check"></i><b>6.2.6</b> A word about <code>coord_sf()</code></a></li>
<li class="chapter" data-level="6.2.7" data-path="spatdata.html"><a href="spatdata.html#a-word-about-resolution-of-spatial-vector-data"><i class="fa fa-check"></i><b>6.2.7</b> A word about <em>resolution</em> of spatial vector data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="spatdata.html"><a href="spatdata.html#yucatan-jay-occurrences"><i class="fa fa-check"></i><b>6.3</b> Yucatan Jay Occurrences</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="spatdata.html"><a href="spatdata.html#example-data-set-with-latitude-and-longitude-points"><i class="fa fa-check"></i><b>6.3.1</b> Example data set with Latitude and Longitude points</a></li>
<li class="chapter" data-level="6.3.2" data-path="spatdata.html"><a href="spatdata.html#plotting-lat-long-data"><i class="fa fa-check"></i><b>6.3.2</b> Plotting Lat-Long data</a></li>
<li class="chapter" data-level="6.3.3" data-path="spatdata.html"><a href="spatdata.html#but-geom_point-wont-work-with-different-projections-coordinate-reference-sysytems"><i class="fa fa-check"></i><b>6.3.3</b> But, <code>geom_point()</code> won’t work with Different Projections / Coordinate Reference Sysytems</a></li>
<li class="chapter" data-level="6.3.4" data-path="spatdata.html"><a href="spatdata.html#turning-something-into-a-simple-features-object"><i class="fa fa-check"></i><b>6.3.4</b> Turning something into a simple features object</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="spatdata.html"><a href="spatdata.html#geometric-operations"><i class="fa fa-check"></i><b>6.4</b> Geometric operations</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="spatdata.html"><a href="spatdata.html#spatial-intersection"><i class="fa fa-check"></i><b>6.4.1</b> Spatial Intersection</a></li>
<li class="chapter" data-level="6.4.2" data-path="spatdata.html"><a href="spatdata.html#treat-the-result-as-a-tibble"><i class="fa fa-check"></i><b>6.4.2</b> Treat the result as a tibble</a></li>
<li class="chapter" data-level="6.4.3" data-path="spatdata.html"><a href="spatdata.html#the-same-filtering-can-be-done-on-the-state-polygons"><i class="fa fa-check"></i><b>6.4.3</b> The same filtering can be done on the state polygons</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="spatdata.html"><a href="spatdata.html#joint-operations-with-raster-and-vector-data-i-masking-a-raster-with-a-polygon"><i class="fa fa-check"></i><b>6.5</b> Joint Operations with Raster and Vector data I: Masking a Raster with a Polygon</a></li>
<li class="chapter" data-level="6.6" data-path="spatdata.html"><a href="spatdata.html#joint-operations-with-raster-and-vector-data-ii-extracting-raster-values-at-a-set-of-spatial-points"><i class="fa fa-check"></i><b>6.6</b> Joint Operations with Raster and Vector data II: Extracting raster values at a set of spatial points</a></li>
<li class="chapter" data-level="6.7" data-path="spatdata.html"><a href="spatdata.html#spat_data_appendix"><i class="fa fa-check"></i><b>6.7</b> Appendix: Obtaining and Reducing The Example Spatial Datasets</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="spatdata.html"><a href="spatdata.html#raster-data"><i class="fa fa-check"></i><b>6.7.1</b> Raster Data</a></li>
<li class="chapter" data-level="6.7.2" data-path="spatdata.html"><a href="spatdata.html#vector-data"><i class="fa fa-check"></i><b>6.7.2</b> Vector data</a></li>
<li class="chapter" data-level="6.7.3" data-path="spatdata.html"><a href="spatdata.html#species-occurrence-data"><i class="fa fa-check"></i><b>6.7.3</b> Species Occurrence Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="geassoc.html"><a href="geassoc.html"><i class="fa fa-check"></i><b>7</b> Genetic and Environmental Associations</a>
<ul>
<li class="chapter" data-level="7.1" data-path="geassoc.html"><a href="geassoc.html#background"><i class="fa fa-check"></i><b>7.1</b> Background</a></li>
<li class="chapter" data-level="7.2" data-path="geassoc.html"><a href="geassoc.html#motivation"><i class="fa fa-check"></i><b>7.2</b> Motivation</a></li>
<li class="chapter" data-level="7.3" data-path="geassoc.html"><a href="geassoc.html#housekeeping"><i class="fa fa-check"></i><b>7.3</b> Housekeeping</a></li>
<li class="chapter" data-level="7.4" data-path="geassoc.html"><a href="geassoc.html#running-gradient-forest"><i class="fa fa-check"></i><b>7.4</b> Running Gradient Forest</a></li>
<li class="chapter" data-level="7.5" data-path="geassoc.html"><a href="geassoc.html#basic-gradient-forest-preparation"><i class="fa fa-check"></i><b>7.5</b> Basic Gradient Forest Preparation</a></li>
<li class="chapter" data-level="7.6" data-path="geassoc.html"><a href="geassoc.html#defining-genomic-vulnerabilitygenomic-offset-given-future-climate-predictions"><i class="fa fa-check"></i><b>7.6</b> Defining “Genomic Vulnerability/Genomic offset” Given Future Climate Predictions</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conclude.html"><a href="conclude.html"><i class="fa fa-check"></i><b>8</b> Concluding Remarks / Parting Words</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research for Conservation — Mérida, Mexico</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatdata" class="section level1" number="6">
<h1><span class="header-section-number">Session 6</span> Handling and Visualizing Spatial Data in R</h1>
<p>In the previous session, Marius gave a very nice overview of <em>environmental</em> data,
which is typically stored in <em>raster</em> form. He described properties of raster
data and how to find data sets relevant to biological questions.</p>
<p>In this session we give an overview of how to handle spatial data
in R. Our topics are:</p>
<ol style="list-style-type: decimal">
<li>Handling raster data</li>
<li>Some background on spatial <em>vector</em> data</li>
<li>Handling vector data in R.</li>
<li>Geometric operations on spatial data.</li>
<li>Plotting spatial data.</li>
</ol>
<p>Let’s load the main libraries that we will use for this session:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="spatdata.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb218-2"><a href="spatdata.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb218-3"><a href="spatdata.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<div id="handling-spatial-rasters-in-r" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Handling Spatial Rasters in R</h2>
<p>Regardless of where an environmental data set comes from, if it
is stored as a spatial raster it can be read into R and manipulated
as an R object.</p>
<p>Today, the main package for handling raster data in R is
‘terra.’</p>
<p>I have stored a few small raster data sets showing parts of the
Yucatán Peninsula in this repository for examples.
<a href="spatdata.html#spat_data_appendix">This section</a> provides some details about how these
small data sets were obtained.</p>
<div id="reading-and-printing-raster-data" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Reading and Printing Raster Data</h3>
<p>Let us read in two different raster data sets. The first shows average maximum
temperature across space around the Yucatán Peninsula in each of the twelve months,
and the second shows the values of different BioClim bioclimatic variables over space.</p>
<p>We read them in using the <code>rast()</code> function from the ‘terra’ package:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="spatdata.html#cb219-1" aria-hidden="true" tabindex="-1"></a>yuc_tmax <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;data/spatial/worldclim/yp_tmax.tif&quot;</span>)</span>
<span id="cb219-2"><a href="spatdata.html#cb219-2" aria-hidden="true" tabindex="-1"></a>yuc_bioc <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;data/spatial/worldclim/yp_bioc.tif&quot;</span>)</span></code></pre></div>
<p>These are stored as <code>SpatRaster</code> objects. This is a particular class from
the ‘terra’ package. When we print them we see some relevant information
about them:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="spatdata.html#cb220-1" aria-hidden="true" tabindex="-1"></a>yuc_tmax</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 270, 540, 12  (nrow, ncol, nlyr)
## resolution  : 0.008333, 0.008333  (x, y)
## extent      : -91, -86.5, 19.5, 21.75  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : yp_tmax.tif 
## names       : MEX_1, MEX_2, MEX_3, MEX_4, MEX_5, MEX_6, ... 
## min values  :  27.2,  27.9,  29.0,  30.4,  31.6,  31.9, ... 
## max values  :  31.2,  32.4,  34.7,  36.6,  37.5,  35.3, ...</code></pre>
<p>Or</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="spatdata.html#cb222-1" aria-hidden="true" tabindex="-1"></a>yuc_bioc</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 270, 540, 19  (nrow, ncol, nlyr)
## resolution  : 0.008333, 0.008333  (x, y)
## extent      : -91, -86.5, 19.5, 21.75  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : yp_bioc.tif 
## names       : wc2.1~bio_1, wc2.1~bio_2, wc2.1~bio_3, wc2.1~bio_4, wc2.1~bio_5, wc2.1~bio_6, ... 
## min values  :      24.962,       7.425,      59.325,     149.395,      32.400,      14.400, ... 
## max values  :       26.95,       15.27,       73.53,      219.19,       37.50,       20.00, ...</code></pre>
<p>This output gives information about the parameters of environmental data that
Marius has just told us about: for example, the <em>extent</em> (<code>extent</code>) of the raster, the
<em>coordinate reference system</em> and <em>projection</em> (<code>coord. ref.</code>) and the <em>resolution</em>
(<code>resolution</code>) of the environmental data.</p>
<p>There are two lines that I want to emphasize, in particular.</p>
<pre><code>dimensions  : 270, 540, 12  (nrow, ncol, nlyr)</code></pre>
<p>This tells us the number of rows and columns in the raster, and also very importantly,
tells us how many <em>layers</em> are in this SpatRaster object. In this case there are 12 layers,
one for each month.</p>
<p>The line</p>
<pre><code>names       : MEX_1, MEX_2, MEX_3, MEX_4, MEX_5, MEX_6, ... </code></pre>
<p>Gives us the names for each layer.</p>
<p>There are many ways to manipulate SpatRaster objects. We won’t go into many,
at this point, other
than to say that you can extract specific layers like</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="spatdata.html#cb226-1" aria-hidden="true" tabindex="-1"></a>yuc_tmax<span class="sc">$</span>MEX_10</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 270, 540, 1  (nrow, ncol, nlyr)
## resolution  : 0.008333, 0.008333  (x, y)
## extent      : -91, -86.5, 19.5, 21.75  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : yp_tmax.tif 
## name        : MEX_10 
## min value   :   30.4 
## max value   :   33.3</code></pre>
<p>For a great introduction to all the ways you can manipulation rasters
with functions from the ‘terra’ package, see the ‘terra’ documentation
at: <a href="https://rspatial.org/terra/spatial/index.html">https://rspatial.org/terra/spatial/index.html</a>.</p>
</div>
<div id="plotting-raster-data-with-plot" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Plotting Raster Data with <code>plot()</code></h3>
<p>The easiest way to plot raster data, in order to get an overview of
the values in a raster, is to use the <code>plot()</code> function, which, if the
‘terra’ package is available, has a special set of methods for dealing
with SpatRaster objects.</p>
<p>This <code>plot()</code> function is optimized for raster data, and renders photos quite
quickly. It uses a default color scheme for the continuous numeric values
in each cell of the raster, and it plots each layer as a separate panel.</p>
<p>For example, let’s look at the maximum temperature
data:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="spatdata.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yuc_tmax)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
<p>The 12 different panels here correspond to the twelve different layers in the
<code>SpatRaster</code>, each of these corresponding to one of the twelve months of
the year.</p>
<p>Take a moment to investigate those plots and ponder questions like:</p>
<ul>
<li>Where is it the coolest? Where it is the warmest?</li>
<li>Which month appears to have the most/least variation in temperature across
the Peninsula?</li>
</ul>
<p>It is also worth plotting the BioClim data to see how much these
bioclimatic variables differ across the Peninsula:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="spatdata.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use maxnl == 20 to make sure all 19 layers are plotted</span></span>
<span id="cb229-2"><a href="spatdata.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yuc_bioc, <span class="at">maxnl =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>This is really cool to see! Especially for someone that is not super familiar
with the Yucatán—there is a lot of biologically relevant climatic variation
across the peninsula.</p>
<p>So, what do all these, <code>bio_1</code> through <code>bio_16</code> mean? They are defined as
follows:</p>
<ul>
<li>BIO1 = Annual Mean Temperature</li>
<li>BIO2 = Mean Diurnal Range (Mean of monthly (max temp - min temp))</li>
<li>BIO3 = Isothermality (BIO2/BIO7) (×100)</li>
<li>BIO4 = Temperature Seasonality (standard deviation ×100)</li>
<li>BIO5 = Max Temperature of Warmest Month</li>
<li>BIO6 = Min Temperature of Coldest Month</li>
<li>BIO7 = Temperature Annual Range (BIO5-BIO6)</li>
<li>BIO8 = Mean Temperature of Wettest Quarter</li>
<li>BIO9 = Mean Temperature of Driest Quarter</li>
<li>BIO10 = Mean Temperature of Warmest Quarter</li>
<li>BIO11 = Mean Temperature of Coldest Quarter</li>
<li>BIO12 = Annual Precipitation</li>
<li>BIO13 = Precipitation of Wettest Month</li>
<li>BIO14 = Precipitation of Driest Month</li>
<li>BIO15 = Precipitation Seasonality (Coefficient of Variation)</li>
<li>BIO16 = Precipitation of Wettest Quarter</li>
<li>BIO17 = Precipitation of Driest Quarter</li>
<li>BIO18 = Precipitation of Warmest Quarter</li>
<li>BIO19 = Precipitation of Coldest Quarter</li>
</ul>
<p>So, this is really neat. You can very quickly see that, although
there is not a huge amount of temperature variation, there
is quite a bit of variation in precipitation across the
peninsula.</p>
</div>
<div id="plotting-raster-data-with-ggplot2" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Plotting raster data with ggplot2</h3>
<p><code>ggplot</code> only knows how to plot data that are stored in data frames
or tibbles. This means that you cannot hand it a <code>SpatRaster</code> object
directly for plotting.</p>
<p>There is some support for ggplot from the authors of the ‘terra’ package,
in a package called ‘rasterVis.’ This doesn’t seem quite ready for
prime time yet (i.e., the version on CRAN has some bugs in it.)</p>
<p>Alternatively, if you have very large rasters with colors defined by levels
of red, blue, and green, there are fast alternatives to include those within
ggplot (See CH’s session next!)</p>
<p>Otherwise, the simplest approach to getting all the features of ggplot
for plotting rasters is just to convert the information in the raster to
a data frame. This can be done with <code>as.data.frame()</code>, as described
by the help information at <code>?terra::as.data.frame()</code>.</p>
<p>When applied to a <code>SpatRaster</code> object, <code>as.data.frame()</code> creates a column in a
data frame for every layer of the raster. If you, additionally, set
<code>xy = TRUE</code>, then the center coordinates of each raster cell are included
in that data frame.</p>
<p>Thus, we can make a tibble out of a raster and then put everything into
four columns, such that it is easy for ggplot to handle it:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="spatdata.html#cb230-1" aria-hidden="true" tabindex="-1"></a>yuc_bioc_tib <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb230-2"><a href="spatdata.html#cb230-2" aria-hidden="true" tabindex="-1"></a>  yuc_bioc,</span>
<span id="cb230-3"><a href="spatdata.html#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xy =</span> <span class="cn">TRUE</span></span>
<span id="cb230-4"><a href="spatdata.html#cb230-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb230-5"><a href="spatdata.html#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb230-6"><a href="spatdata.html#cb230-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb230-7"><a href="spatdata.html#cb230-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(x, y),</span>
<span id="cb230-8"><a href="spatdata.html#cb230-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>, </span>
<span id="cb230-9"><a href="spatdata.html#cb230-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb230-10"><a href="spatdata.html#cb230-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb230-11"><a href="spatdata.html#cb230-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-12"><a href="spatdata.html#cb230-12" aria-hidden="true" tabindex="-1"></a><span class="co"># see what that looks like:</span></span>
<span id="cb230-13"><a href="spatdata.html#cb230-13" aria-hidden="true" tabindex="-1"></a>yuc_bioc_tib</span></code></pre></div>
<pre><code>## # A tibble: 1,718,455 × 4
##        x     y layer            value
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
##  1 -88.1  21.6 wc2.1_30s_bio_1   25.7
##  2 -88.1  21.6 wc2.1_30s_bio_2   11.1
##  3 -88.1  21.6 wc2.1_30s_bio_3   70.6
##  4 -88.1  21.6 wc2.1_30s_bio_4  179. 
##  5 -88.1  21.6 wc2.1_30s_bio_5   33  
##  6 -88.1  21.6 wc2.1_30s_bio_6   17.3
##  7 -88.1  21.6 wc2.1_30s_bio_7   15.7
##  8 -88.1  21.6 wc2.1_30s_bio_8   27.0
##  9 -88.1  21.6 wc2.1_30s_bio_9   24.9
## 10 -88.1  21.6 wc2.1_30s_bio_10  27.5
## # … with 1,718,445 more rows</code></pre>
<p>In that format, ggplot knows just what do do with it, and you can plot
it quite easily. First, let’s just plot one of the variables, BIO_1:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="spatdata.html#cb232-1" aria-hidden="true" tabindex="-1"></a>yuc_bioc_tib <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="spatdata.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(layer <span class="sc">==</span> <span class="st">&quot;wc2.1_30s_bio_1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-3"><a href="spatdata.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb232-4"><a href="spatdata.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-5"><a href="spatdata.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb232-6"><a href="spatdata.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb232-7"><a href="spatdata.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()  <span class="co"># here, this maintains the aspect ratio</span></span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
<p>One important thing to note: if you want to plot all the different bioclim
variables in ggplot using faceting, there is a problem — the colors
will apply to the whole range of possible values, so that most won’t show
up well. This is especially obvious with the bioclim variables which
are on totally different scales:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="spatdata.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yuc_bioc_tib, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb233-2"><a href="spatdata.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-3"><a href="spatdata.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb233-4"><a href="spatdata.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb233-5"><a href="spatdata.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb233-6"><a href="spatdata.html#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>layer, <span class="at">ncol =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>Ha! That looks terrible.</p>
<p><em>On the other hand</em>, if every layer is plotting the same variable, then it can be
quite advantageous to have the same color bar for all layers. For example, when
looking at the maximum temperature each month, it is actually better to have
the same colour scale for all plots:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="spatdata.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a tibble of the tmax values</span></span>
<span id="cb234-2"><a href="spatdata.html#cb234-2" aria-hidden="true" tabindex="-1"></a>yuc_tmax_tib <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb234-3"><a href="spatdata.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  yuc_tmax,</span>
<span id="cb234-4"><a href="spatdata.html#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xy =</span> <span class="cn">TRUE</span></span>
<span id="cb234-5"><a href="spatdata.html#cb234-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb234-6"><a href="spatdata.html#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-7"><a href="spatdata.html#cb234-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb234-8"><a href="spatdata.html#cb234-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(x, y),</span>
<span id="cb234-9"><a href="spatdata.html#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>, </span>
<span id="cb234-10"><a href="spatdata.html#cb234-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb234-11"><a href="spatdata.html#cb234-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb234-12"><a href="spatdata.html#cb234-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb234-13"><a href="spatdata.html#cb234-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># here make a factor of them so they came out in the</span></span>
<span id="cb234-14"><a href="spatdata.html#cb234-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># right order</span></span>
<span id="cb234-15"><a href="spatdata.html#cb234-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">layer_f =</span> <span class="fu">factor</span>(layer, <span class="at">levels =</span> <span class="fu">unique</span>(layer))</span>
<span id="cb234-16"><a href="spatdata.html#cb234-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb234-17"><a href="spatdata.html#cb234-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-18"><a href="spatdata.html#cb234-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plot them</span></span>
<span id="cb234-19"><a href="spatdata.html#cb234-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yuc_tmax_tib, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb234-20"><a href="spatdata.html#cb234-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-21"><a href="spatdata.html#cb234-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb234-22"><a href="spatdata.html#cb234-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb234-23"><a href="spatdata.html#cb234-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb234-24"><a href="spatdata.html#cb234-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>layer_f, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
<p>That makes it a lot easier to see the annual variation in maximum temperature.</p>
<div id="quickly-back-to-terras-plot-function" class="section level4" number="6.1.3.1">
<h4><span class="header-section-number">6.1.3.1</span> Quickly back to ’terra’s <code>plot()</code> function</h4>
<p>It is worth noting that a similar effect can be achieved by setting the
range in terra’s <code>plot()</code> function:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="spatdata.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yuc_tmax, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">27</span>,<span class="dv">38</span>))</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>In summary, the <code>plot()</code> function from the terra package is fast and efficient
for plotting rasters. However, if you are more comfortable making plots with
‘ggplot2,’ you can use that for plotting rasters, but you need to
convert the raster to a data frame.</p>
</div>
</div>
</div>
<div id="vector-spatial-data" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Vector Spatial Data</h2>
<p>Raster data consist of a whole grid of <em>cells</em> or <em>pixels</em>. In this
way, they are very much like a digital photograph, or a JPG. When you
zoom in on a raster, things get <em>pixelated</em>, just like a digital photograph.</p>
<p>Contrast this to when you zoom in on the text of a PDF file. The edges of the
letters stay <em>smooth</em> even at very high values of zoom. That is because those letters
are not defined by lots of pixels (some white and some black), but rather, by
a <em>vector</em> specification of the curves or lines that make up each letter.</p>
<p>Spatial data has such an analogue known as <em>vector spatial data</em>. This type of
spatial data is not defined in a series of cells, but rather in terms of
a number of different points.</p>
<p>This can be much more efficient for storing spatial features that are lines or boundaries.
For example, two points in space can define a single line, which will not grow “fuzzy”
when you zoom in on it.</p>
<p>Vector spatial data is particularly appropriate for representing things like
country boundaries, rivers, coastlines, the shorelines of lakes, highways and
roads, and points in space (for example, sampling locations of birds, etc.)</p>
<div id="vector-data-features" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Vector data features</h3>
<p>There are three main <em>basic</em> types of vector spatial data features:</p>
<ol style="list-style-type: decimal">
<li><strong>Points</strong>: simply points on the landscape. (Like sampling locations.)</li>
<li><strong>Linestrings</strong>: lines connecting a series of points (good for rivers or highways, etc.)</li>
<li><strong>Polygons</strong>: lines connecting a series of points that eventually come back to themselves
to create a closed shape. (good for state boundaries, lakes, coastlines, etc.).</li>
</ol>
<p>Polygons can be quite complex, as they may include holes (like a donut!), but, for the most
part, those complexities can remain hidden from you, the R user.</p>
</div>
<div id="shapefiles" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Shapefiles</h3>
<p>The most typical format for storing vector spatial data is the Shapefile, which
is commonly used for GIS programs, like ArcView.</p>
<p>A shapefile has the extension <code>.shp</code> and is a binary format describing the
vector data. It is not human readable.</p>
<p>Typically, along with the shapefile will be a number of other files with the
same first part of their name, but with different extensions, like
<code>.shx</code>, <code>.dbf</code>, <code>.prj</code>.</p>
<p>For example, this course repository has a shapefile for the Mexican states
in the directory <code>data/spatial/ne_mexico_states</code> whose contents look like:</p>
<pre><code>ne_mexico_states/
├── ne_mexico_states.dbf
├── ne_mexico_states.prj
├── ne_mexico_states.shp
└── ne_mexico_states.shx</code></pre>
<p>It is worth pointing out that the <code>.prj</code> file contains information about the
projection of the points, and <code>.dbf</code> file contains data that correspond to
each of the geographic features in the shapefile.</p>
<p><a href="spatdata.html#spat_data_appendix">This section</a> provides some details about how the
Mexican states shapefile was obtained.</p>
</div>
<div id="spatial-vector-data-in-r" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Spatial vector data in R</h3>
<p>There are a few different packages for handling spatial vector data in R.</p>
<p>‘terra’ can deal with it.</p>
<p>However, I am particularly fond of the package ‘sf,’ which implements
<em>simple features</em> for R. Simple features is a defined <em>standard</em> for
representing spatial data.</p>
<p>The <code>sf</code> package stores spatial vector data in a special kind of data
frame that has any number of columns that represent data specific
to each row, and then a special list-column that contains the <em>geometry</em>
associated with the row. This geometry is just a series of points
that define points, linestings, or polygons, <em>or</em> collections of
multiple points, linestrings, or polygons.</p>
<p>All the functions in the ‘sf’ package start with <code>st_</code>.</p>
<p>Excellent introductory documentation for ‘sf’ is available at
<a href="https://r-spatial.github.io/sf/articles/sf1.html">https://r-spatial.github.io/sf/articles/sf1.html</a>,
and they have a great cheat sheet for the package too:</p>
<p><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/sf.pdf"><img src="https://raw.githubusercontent.com/rstudio/cheatsheets/master/pngs/sf.png" /></a></p>
</div>
<div id="an-example-mexican-states" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> An example: Mexican states</h3>
<p>We can use the <code>st_read()</code> function to read in a shapefile of Mexican states.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="spatdata.html#cb237-1" aria-hidden="true" tabindex="-1"></a>mex_states <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/spatial/ne_mexico_states/ne_mexico_states.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `ne_mexico_states&#39; from data source 
##   `/Users/eriq/Documents/git-repos/merida-workshop-2022/data/spatial/ne_mexico_states/ne_mexico_states.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 33 features and 83 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -118.4 ymin: 14.55 xmax: -86.7 ymax: 32.71
## Geodetic CRS:  GCS_unknown</code></pre>
<p>It turns out that there are <em>a lot</em> of columns in that result. To make it easier to
look at, let’s just look at just a few of the columns. We can do all the typical
tidyverse operations on this object, so we use <code>select()</code> to get a few columns,
and we make sure we get the <code>geometry</code> column, which has the spatial information in it!</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="spatdata.html#cb239-1" aria-hidden="true" tabindex="-1"></a>ms_thin <span class="ot">&lt;-</span> mex_states <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="spatdata.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb239-3"><a href="spatdata.html#cb239-3" aria-hidden="true" tabindex="-1"></a>    name,</span>
<span id="cb239-4"><a href="spatdata.html#cb239-4" aria-hidden="true" tabindex="-1"></a>    type,</span>
<span id="cb239-5"><a href="spatdata.html#cb239-5" aria-hidden="true" tabindex="-1"></a>    type_en,</span>
<span id="cb239-6"><a href="spatdata.html#cb239-6" aria-hidden="true" tabindex="-1"></a>    postal,</span>
<span id="cb239-7"><a href="spatdata.html#cb239-7" aria-hidden="true" tabindex="-1"></a>    geometry</span>
<span id="cb239-8"><a href="spatdata.html#cb239-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb239-9"><a href="spatdata.html#cb239-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-10"><a href="spatdata.html#cb239-10" aria-hidden="true" tabindex="-1"></a>ms_thin</span></code></pre></div>
<pre><code>## Simple feature collection with 33 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -118.4 ymin: 14.55 xmax: -86.7 ymax: 32.71
## Geodetic CRS:  GCS_unknown
## First 10 features:
##               name   type type_en postal
## 1           Sonora Estado   State     SO
## 2  Baja California Estado   State     BC
## 3        Chihuahua Estado   State     CH
## 4         Coahuila Estado   State     CO
## 5       Tamaulipas Estado   State     TM
## 6       Nuevo León Estado   State     NL
## 7     Quintana Roo Estado   State     QR
## 8         Campeche Estado   State     CM
## 9          Tabasco Estado   State     TB
## 10         Chiapas Estado   State     CS
##                          geometry
## 1  MULTIPOLYGON (((-114.8 32.5...
## 2  MULTIPOLYGON (((-114.7 32.7...
## 3  MULTIPOLYGON (((-109 31.33,...
## 4  MULTIPOLYGON (((-103.3 29.0...
## 5  MULTIPOLYGON (((-99.71 27.6...
## 6  MULTIPOLYGON (((-99.81 27.7...
## 7  MULTIPOLYGON (((-88.3 18.48...
## 8  MULTIPOLYGON (((-89.15 17.9...
## 9  MULTIPOLYGON (((-90.99 17.8...
## 10 MULTIPOLYGON (((-91.43 17.2...</code></pre>
<p>Here, we see that each state takes up 1 row, and the state boundary is stored
as a series of points in a “MULTIPOLYGON” sf data structure.</p>
</div>
<div id="plotting-simple-features-with-ggplot" class="section level3" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> Plotting simple features with <code>ggplot()</code></h3>
<p>The authors of the ‘sf’ package worked with Hadley Wickham to provide
the <code>geom_sf()</code> function to plot simple feature objects. The <code>geom_sf()</code>
object does not require that aesthetics for <code>x</code> and <code>y</code> be set, because it
uses the geometry information directly.</p>
<p>For example, we can plot the boundaries of the Mexican states like this:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="spatdata.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ms_thin) <span class="sc">+</span></span>
<span id="cb241-2"><a href="spatdata.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb241-3"><a href="spatdata.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb241-4"><a href="spatdata.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-144-1.png" width="672" /></p>
<p>Note that we can also map aesthetics like fill or color to different
values in the simple features data frame:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="spatdata.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ms_thin) <span class="sc">+</span></span>
<span id="cb242-2"><a href="spatdata.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb242-3"><a href="spatdata.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb242-4"><a href="spatdata.html#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-145-1.png" width="672" /></p>
</div>
<div id="a-word-about-coord_sf" class="section level3" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> A word about <code>coord_sf()</code></h3>
<p>The <code>coord_sf()</code> function let’s you define the coordinate
system for plotting <code>sf</code> objects. By default, it plots
a planar system of longitude and latitude, but it also
accepts different projections with its <code>crs</code> argument.</p>
<p>Using a different <code>crs</code> will reproject any simple features data from whatever coordinate
reference system them are in to the new one.</p>
<p>For example, we can plot the Mexican states using a Lambert Conformal Conic (LCC)
projection, like this:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="spatdata.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the projection with this long string</span></span>
<span id="cb243-2"><a href="spatdata.html#cb243-2" aria-hidden="true" tabindex="-1"></a>mex_lcc <span class="ot">&lt;-</span> <span class="st">&quot;+proj=lcc +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-102 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m no_defs&quot;</span></span>
<span id="cb243-3"><a href="spatdata.html#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="spatdata.html#cb243-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-5"><a href="spatdata.html#cb243-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass that string as the `crs` argument to coord_sf()</span></span>
<span id="cb243-6"><a href="spatdata.html#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ms_thin) <span class="sc">+</span></span>
<span id="cb243-7"><a href="spatdata.html#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb243-8"><a href="spatdata.html#cb243-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb243-9"><a href="spatdata.html#cb243-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> mex_lcc)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<p>Note how the latitude lines are curved after projection.</p>
</div>
<div id="a-word-about-resolution-of-spatial-vector-data" class="section level3" number="6.2.7">
<h3><span class="header-section-number">6.2.7</span> A word about <em>resolution</em> of spatial vector data</h3>
<p>You can zoom in indefinitely on vector defined <em>fonts</em> (like in a PDF file)
because the curves that make up the letter are defined by equations.</p>
<p>That is not the case with most spatial vector data. Rather, spatial
objects are defined by the points within them.</p>
<p>Landforms are not perfectly straight lines, nor can they
be represented by simple equations. In fact, landforms have a fractal
nature. So, the number of points used to represent a shape (like a coastline)
in space determines its <em>resolution</em>.</p>
<p>We can demonstrate this by viewing the northern Yucatán coastline at
different resolutions. I previously downloaded Natural Earth Data maps
of different resolutions (<a href="spatdata.html#ne_resolutions">details here</a>)</p>
<p><img src="images/5.0/vector-resolutions.svg" width="70%" style="display: block; margin: auto;" /></p>
<p>Thus, spatial vector data still have a resolution, which is determined by how
many points are available to represent curvy lines.</p>
<p>If you are plotting maps of the entire world, low resolution works fine. If you
are making maps of smaller areas, then higher resolution is needed.</p>
<p>For very fine scale coastlines, you can use the U.S. National Oceanic and
Atmospheric Administration’s
<a href="https://www.ngdc.noaa.gov/mgg/shorelines/">Global Self-consistent, Hierarchical, High-resolution Geography Database (GSHHG)</a>.</p>
<p>This is a very large data set, but clearly has much higher resolution:
<img src="images/5.0/gshhg.svg" width="70%" style="display: block; margin: auto;" /></p>
<p>In short, if you are working in small areas, then higher resolution
sources are needed.</p>
</div>
</div>
<div id="yucatan-jay-occurrences" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Yucatan Jay Occurrences</h2>
<p>Today it is possible to collect a lot of data while using a GPS device.
This gives you an unprecedented ability to collect <em>georeferenced</em> data.</p>
<p>In most cases, georeferenced data will correspond to samples that were
collected at different <em>points</em>. In other words, they represent point
data.</p>
<p>These data are almost always given as variables with a latitude and
a longitude.</p>
<div id="example-data-set-with-latitude-and-longitude-points" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Example data set with Latitude and Longitude points</h3>
<p>For an example of such data, I have downloaded 25,135 observations of the
Yucatán Jay from the GBIF data set and saved it in the course repository.
<img src="images/5.0/yuc_jay.jpg" width="80%" style="display: block; margin: auto;" /></p>
<p>It can be read in like this:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="spatdata.html#cb244-1" aria-hidden="true" tabindex="-1"></a>yjay_full <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(</span>
<span id="cb244-2"><a href="spatdata.html#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data/spatial/Cyanocorax-yucatanicus.tsv.gz&quot;</span>,</span>
<span id="cb244-3"><a href="spatdata.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span>, </span>
<span id="cb244-4"><a href="spatdata.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb244-5"><a href="spatdata.html#cb244-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: One or more parsing issues, see `problems()`
## for details</code></pre>
<p>There are a lot of columns and rows in that. So, let’s make it a little
smaller by selecting only a few columns, and limiting it to
EBIRD observations from the year 2017.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="spatdata.html#cb246-1" aria-hidden="true" tabindex="-1"></a>yjay_thin <span class="ot">&lt;-</span> yjay_full <span class="sc">%&gt;%</span></span>
<span id="cb246-2"><a href="spatdata.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb246-3"><a href="spatdata.html#cb246-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(collectionCode, <span class="st">&quot;EBIRD&quot;</span>), <span class="co"># keep just the EBIRD-associated records</span></span>
<span id="cb246-4"><a href="spatdata.html#cb246-4" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2017</span>                         <span class="co"># from the year 2017</span></span>
<span id="cb246-5"><a href="spatdata.html#cb246-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb246-6"><a href="spatdata.html#cb246-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(  <span class="co"># whittle it down to just a few columns of data</span></span>
<span id="cb246-7"><a href="spatdata.html#cb246-7" aria-hidden="true" tabindex="-1"></a>    gbifID,</span>
<span id="cb246-8"><a href="spatdata.html#cb246-8" aria-hidden="true" tabindex="-1"></a>    decimalLongitude,</span>
<span id="cb246-9"><a href="spatdata.html#cb246-9" aria-hidden="true" tabindex="-1"></a>    decimalLatitude,</span>
<span id="cb246-10"><a href="spatdata.html#cb246-10" aria-hidden="true" tabindex="-1"></a>    day,</span>
<span id="cb246-11"><a href="spatdata.html#cb246-11" aria-hidden="true" tabindex="-1"></a>    month,</span>
<span id="cb246-12"><a href="spatdata.html#cb246-12" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb246-13"><a href="spatdata.html#cb246-13" aria-hidden="true" tabindex="-1"></a>    individualCount,</span>
<span id="cb246-14"><a href="spatdata.html#cb246-14" aria-hidden="true" tabindex="-1"></a>    stateProvince,</span>
<span id="cb246-15"><a href="spatdata.html#cb246-15" aria-hidden="true" tabindex="-1"></a>    locality</span>
<span id="cb246-16"><a href="spatdata.html#cb246-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb246-17"><a href="spatdata.html#cb246-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-18"><a href="spatdata.html#cb246-18" aria-hidden="true" tabindex="-1"></a><span class="co"># and look at the first few rows:</span></span>
<span id="cb246-19"><a href="spatdata.html#cb246-19" aria-hidden="true" tabindex="-1"></a>yjay_thin</span></code></pre></div>
<pre><code>## # A tibble: 3,032 × 9
##     gbifID decimalLongitude decimalLatitude   day month
##      &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  3.30e9            -88.2            21.6    21     5
##  2  3.30e9            -87.0            20.7    30     9
##  3  3.29e9            -88.0            21.6    20    10
##  4  3.29e9            -87.0            20.8    12    12
##  5  3.29e9            -88.2            20.8    28     7
##  6  3.29e9            -87.4            20.2    24     2
##  7  3.29e9            -88.2            21.6    21     5
##  8  3.29e9            -87.7            18.7    20    11
##  9  3.29e9            -88.5            17.8    14     4
## 10  3.28e9            -87.9            21.4     5     5
## # … with 3,022 more rows, and 4 more variables:
## #   year &lt;dbl&gt;, individualCount &lt;dbl&gt;,
## #   stateProvince &lt;chr&gt;, locality &lt;chr&gt;</code></pre>
</div>
<div id="plotting-lat-long-data" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Plotting Lat-Long data</h3>
<p>If you have lat-long data, you can typically plot them with <code>ggplot()</code> simply as points,
using <code>geom_point()</code>, <em>so long as your underlying maps and other spatial data
are all in a standard lat-long coordinate system</em>.</p>
<p>The geographic coordinates from GBIF (the Yucatán Jay data) use the WGS84 standard,
which is the same as the coordinate reference system of <code>ms_thin</code>, as seen by:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="spatdata.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(ms_thin)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: GCS_unknown 
##   wkt:
## GEOGCRS[&quot;GCS_unknown&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         ID[&quot;EPSG&quot;,6326]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;Degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[1],
##             ANGLEUNIT[&quot;Degree&quot;,0.0174532925199433]],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[2],
##             ANGLEUNIT[&quot;Degree&quot;,0.0174532925199433]]]</code></pre>
<p>Therefore, we can plot the Jay occurrence data like this:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="spatdata.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb250-2"><a href="spatdata.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(   <span class="co"># getting the background map</span></span>
<span id="cb250-3"><a href="spatdata.html#cb250-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ms_thin,</span>
<span id="cb250-4"><a href="spatdata.html#cb250-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb250-5"><a href="spatdata.html#cb250-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb250-6"><a href="spatdata.html#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(  <span class="co"># placing the points</span></span>
<span id="cb250-7"><a href="spatdata.html#cb250-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> yjay_thin, </span>
<span id="cb250-8"><a href="spatdata.html#cb250-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> decimalLongitude, <span class="at">y =</span> decimalLatitude),</span>
<span id="cb250-9"><a href="spatdata.html#cb250-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;deepskyblue3&quot;</span>,</span>
<span id="cb250-10"><a href="spatdata.html#cb250-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb250-11"><a href="spatdata.html#cb250-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">0.2</span></span>
<span id="cb250-12"><a href="spatdata.html#cb250-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb250-13"><a href="spatdata.html#cb250-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb250-14"><a href="spatdata.html#cb250-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
</div>
<div id="but-geom_point-wont-work-with-different-projections-coordinate-reference-sysytems" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> But, <code>geom_point()</code> won’t work with Different Projections / Coordinate Reference Sysytems</h3>
<p>If you try to plot these with the LCC project from above things don’t work out:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="spatdata.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb251-2"><a href="spatdata.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(   <span class="co"># getting the background map</span></span>
<span id="cb251-3"><a href="spatdata.html#cb251-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ms_thin,</span>
<span id="cb251-4"><a href="spatdata.html#cb251-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb251-5"><a href="spatdata.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb251-6"><a href="spatdata.html#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(  <span class="co"># placing the points</span></span>
<span id="cb251-7"><a href="spatdata.html#cb251-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> yjay_thin, </span>
<span id="cb251-8"><a href="spatdata.html#cb251-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> decimalLongitude, <span class="at">y =</span> decimalLatitude),</span>
<span id="cb251-9"><a href="spatdata.html#cb251-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;deepskyblue3&quot;</span>,</span>
<span id="cb251-10"><a href="spatdata.html#cb251-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb251-11"><a href="spatdata.html#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">0.2</span></span>
<span id="cb251-12"><a href="spatdata.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb251-13"><a href="spatdata.html#cb251-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb251-14"><a href="spatdata.html#cb251-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> mex_lcc)  <span class="co"># using projected coordinates!</span></span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>The points are nowhere to be found (Actually, I think that they are all piled
up on top of one another where the single blue dot is visible!), because the x and y coordinates
in an LCC projection are totally different than they are in WGS84!</p>
<p>This shows that if you want to do <em>spatial</em> things on
georeferenced data that simply have lat-long coordinates,
you need to make a spatial object out of those data and
treat them as spatial objects.</p>
<p>Fortunately, that is fairly easy.</p>
</div>
<div id="turning-something-into-a-simple-features-object" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Turning something into a simple features object</h3>
<p>The Jay data can be made an <code>sf</code> object by adding a geometry column to it.
This is done with <code>st_as_sf()</code>:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="spatdata.html#cb252-1" aria-hidden="true" tabindex="-1"></a>yjay_sf <span class="ot">&lt;-</span> yjay_thin <span class="sc">%&gt;%</span></span>
<span id="cb252-2"><a href="spatdata.html#cb252-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(</span>
<span id="cb252-3"><a href="spatdata.html#cb252-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(  <span class="co"># tell it which columns have the latitude and longitude</span></span>
<span id="cb252-4"><a href="spatdata.html#cb252-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;decimalLongitude&quot;</span>,</span>
<span id="cb252-5"><a href="spatdata.html#cb252-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;decimalLatitude&quot;</span></span>
<span id="cb252-6"><a href="spatdata.html#cb252-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb252-7"><a href="spatdata.html#cb252-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span>  <span class="co"># this is the EPSG shorthand for WGS 84</span></span>
<span id="cb252-8"><a href="spatdata.html#cb252-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb252-9"><a href="spatdata.html#cb252-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-10"><a href="spatdata.html#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at it:</span></span>
<span id="cb252-11"><a href="spatdata.html#cb252-11" aria-hidden="true" tabindex="-1"></a>yjay_sf</span></code></pre></div>
<pre><code>## Simple feature collection with 3032 features and 7 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -92.98 ymin: 16.94 xmax: -86.79 ymax: 21.61
## Geodetic CRS:  WGS 84
## # A tibble: 3,032 × 8
##        gbifID   day month  year individualCount
##  *      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;
##  1 3297327310    21     5  2017               1
##  2 3295142622    30     9  2017               2
##  3 3291491655    20    10  2017               1
##  4 3291004959    12    12  2017               8
##  5 3289867554    28     7  2017               8
##  6 3289002522    24     2  2017              NA
##  7 3286797902    21     5  2017               2
##  8 3286393532    20    11  2017               6
##  9 3285803459    14     4  2017               2
## 10 3284777960     5     5  2017               1
## # … with 3,022 more rows, and 3 more variables:
## #   stateProvince &lt;chr&gt;, locality &lt;chr&gt;,
## #   geometry &lt;POINT [°]&gt;</code></pre>
<p>Now, that <code>yjay_sf</code> variable can be treated as a spatial object and plotted
with <code>geom_sf()</code> like this:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="spatdata.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb254-2"><a href="spatdata.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(   <span class="co"># getting the background map</span></span>
<span id="cb254-3"><a href="spatdata.html#cb254-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ms_thin,</span>
<span id="cb254-4"><a href="spatdata.html#cb254-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb254-5"><a href="spatdata.html#cb254-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb254-6"><a href="spatdata.html#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(  <span class="co"># placing the points as spatial objects</span></span>
<span id="cb254-7"><a href="spatdata.html#cb254-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> yjay_sf, </span>
<span id="cb254-8"><a href="spatdata.html#cb254-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;deepskyblue3&quot;</span>,</span>
<span id="cb254-9"><a href="spatdata.html#cb254-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb254-10"><a href="spatdata.html#cb254-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">0.2</span></span>
<span id="cb254-11"><a href="spatdata.html#cb254-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb254-12"><a href="spatdata.html#cb254-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb254-13"><a href="spatdata.html#cb254-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> mex_lcc)  <span class="co"># using projected coordinates!</span></span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>That’s Nice!</p>
<p>Not only does treating these points as spatial objects let us plot it in different
coordinate reference systems, but, it also allows us to to spatial
<em>geometric operations</em> on them. Several examples of which we will show
in the next section.</p>
</div>
</div>
<div id="geometric-operations" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Geometric operations</h2>
<p>The <code>sf</code> package supports a number of geometric operations. We will show just a
few of them here.</p>
<div id="spatial-intersection" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Spatial Intersection</h3>
<p>One very powerful operation is a spatial intersection. These
intersections can be quite complex, though intersecting point
data with polygon data will lead simply to point data, so, for
intersecting points, things are not terribly complex.</p>
<p>For example, what if we want to know which Mexican states each of these observed
Yucatán Jays occurred in.</p>
<p>The GBIF data actually tells us that information in the <code>stateProvice</code> column, but let’s pretend for a
moment that we don’t have that information — only where they birds were caught:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="spatdata.html#cb255-1" aria-hidden="true" tabindex="-1"></a>yjay_just_coord <span class="ot">&lt;-</span> yjay_sf <span class="sc">%&gt;%</span></span>
<span id="cb255-2"><a href="spatdata.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gbifID, geometry)</span>
<span id="cb255-3"><a href="spatdata.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="spatdata.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co"># now, we just have the IDs and the positions of the observations</span></span>
<span id="cb255-5"><a href="spatdata.html#cb255-5" aria-hidden="true" tabindex="-1"></a>yjay_just_coord</span></code></pre></div>
<pre><code>## Simple feature collection with 3032 features and 1 field
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -92.98 ymin: 16.94 xmax: -86.79 ymax: 21.61
## Geodetic CRS:  WGS 84
## # A tibble: 3,032 × 2
##        gbifID       geometry
##         &lt;dbl&gt;    &lt;POINT [°]&gt;
##  1 3297327310 (-88.23 21.55)
##  2 3295142622 (-87.03 20.67)
##  3 3291491655 (-87.98 21.58)
##  4 3291004959 (-86.96 20.77)
##  5 3289867554 (-88.21 20.76)
##  6 3289002522 (-87.43 20.21)
##  7 3286797902 (-88.23 21.55)
##  8 3286393532 (-87.71 18.71)
##  9 3285803459 (-88.53 17.77)
## 10 3284777960 (-87.87 21.41)
## # … with 3,022 more rows</code></pre>
<p>So, if that was all we knew, and we wanted to figure out
which states all those birds were observed in, we
would <em>intersect</em> the location of each
observation with the polygons that define the states.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="spatdata.html#cb257-1" aria-hidden="true" tabindex="-1"></a>jays_in_states <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(</span>
<span id="cb257-2"><a href="spatdata.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  yjay_just_coord, <span class="co"># this requires the spatial object that we made</span></span>
<span id="cb257-3"><a href="spatdata.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  ms_thin</span>
<span id="cb257-4"><a href="spatdata.html#cb257-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be
## spatially constant throughout all geometries</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="spatdata.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the result</span></span>
<span id="cb259-2"><a href="spatdata.html#cb259-2" aria-hidden="true" tabindex="-1"></a>jays_in_states</span></code></pre></div>
<pre><code>## Simple feature collection with 2425 features and 5 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -92.98 ymin: 17.94 xmax: -86.79 ymax: 21.59
## Geodetic CRS:  WGS 84
## # A tibble: 2,425 × 6
##        gbifID name         type   type_en postal
##  *      &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; 
##  1 3295142622 Quintana Roo Estado State   QR    
##  2 3291004959 Quintana Roo Estado State   QR    
##  3 3286393532 Quintana Roo Estado State   QR    
##  4 3282675523 Quintana Roo Estado State   QR    
##  5 3281473008 Quintana Roo Estado State   QR    
##  6 3279106041 Quintana Roo Estado State   QR    
##  7 3277142270 Quintana Roo Estado State   QR    
##  8 3275579212 Quintana Roo Estado State   QR    
##  9 3273312480 Quintana Roo Estado State   QR    
## 10 3252526920 Quintana Roo Estado State   QR    
## # … with 2,415 more rows, and 1 more variable:
## #   geometry &lt;POINT [°]&gt;</code></pre>
<p>No way! That is so cool! This new simple features tibble now has all the
birds that were seen in Mexico, and, for each one, it has added the columns
from the Mexican states data. So, we know for each bird, which state
(in the column <code>name</code>) is was found in.</p>
<p>Now, for example, if we wanted to plot these points and color them by <code>stateProvince</code>
we could do this:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="spatdata.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb261-2"><a href="spatdata.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(   <span class="co"># getting the background map</span></span>
<span id="cb261-3"><a href="spatdata.html#cb261-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ms_thin,</span>
<span id="cb261-4"><a href="spatdata.html#cb261-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb261-5"><a href="spatdata.html#cb261-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb261-6"><a href="spatdata.html#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(  <span class="co"># placing the points as spatial objects</span></span>
<span id="cb261-7"><a href="spatdata.html#cb261-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> jays_in_states, </span>
<span id="cb261-8"><a href="spatdata.html#cb261-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> name), <span class="co"># coloring by name column</span></span>
<span id="cb261-9"><a href="spatdata.html#cb261-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb261-10"><a href="spatdata.html#cb261-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">0.2</span></span>
<span id="cb261-11"><a href="spatdata.html#cb261-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb261-12"><a href="spatdata.html#cb261-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb261-13"><a href="spatdata.html#cb261-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">95</span>, <span class="sc">-</span><span class="dv">85</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">23</span>)) </span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p>Cool!</p>
</div>
<div id="treat-the-result-as-a-tibble" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Treat the result as a tibble</h3>
<p>One very important thing to keep in mind is that a simple features
collection works quite nicely within the tidyverse.</p>
<p>So, for example, if you wanted to retain only those observations of
jays that occurred in the state of Yucatàn, you can use a simple <code>filter()</code>:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="spatdata.html#cb262-1" aria-hidden="true" tabindex="-1"></a>yuc_state_jays <span class="ot">&lt;-</span> jays_in_states <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="spatdata.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Yucatán&quot;</span>)</span>
<span id="cb262-3"><a href="spatdata.html#cb262-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-4"><a href="spatdata.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look:</span></span>
<span id="cb262-5"><a href="spatdata.html#cb262-5" aria-hidden="true" tabindex="-1"></a>yuc_state_jays</span></code></pre></div>
<pre><code>## Simple feature collection with 1082 features and 5 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -90.4 ymin: 19.99 xmax: -87.57 ymax: 21.59
## Geodetic CRS:  WGS 84
## # A tibble: 1,082 × 6
##        gbifID name    type   type_en postal
##  *      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; 
##  1 3297327310 Yucatán Estado State   YU    
##  2 3291491655 Yucatán Estado State   YU    
##  3 3289867554 Yucatán Estado State   YU    
##  4 3286797902 Yucatán Estado State   YU    
##  5 3284777960 Yucatán Estado State   YU    
##  6 3283999442 Yucatán Estado State   YU    
##  7 3243749415 Yucatán Estado State   YU    
##  8 3176970726 Yucatán Estado State   YU    
##  9 2795705902 Yucatán Estado State   YU    
## 10 2794893768 Yucatán Estado State   YU    
## # … with 1,072 more rows, and 1 more variable:
## #   geometry &lt;POINT [°]&gt;</code></pre>
</div>
<div id="the-same-filtering-can-be-done-on-the-state-polygons" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> The same filtering can be done on the state polygons</h3>
<p>By way of demonstration, we could also filter our data set of
state boundaries to have just the state of Yucatán:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="spatdata.html#cb264-1" aria-hidden="true" tabindex="-1"></a>yuc_boundary <span class="ot">&lt;-</span> ms_thin <span class="sc">%&gt;%</span></span>
<span id="cb264-2"><a href="spatdata.html#cb264-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Yucatán&quot;</span>)</span></code></pre></div>
<p>And then we could plot the two together quite easily:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="spatdata.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb265-2"><a href="spatdata.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> yuc_boundary) <span class="sc">+</span> </span>
<span id="cb265-3"><a href="spatdata.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb265-4"><a href="spatdata.html#cb265-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> yuc_state_jays,</span>
<span id="cb265-5"><a href="spatdata.html#cb265-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;deepskyblue3&quot;</span>,</span>
<span id="cb265-6"><a href="spatdata.html#cb265-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb265-7"><a href="spatdata.html#cb265-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">0.2</span></span>
<span id="cb265-8"><a href="spatdata.html#cb265-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb265-9"><a href="spatdata.html#cb265-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb265-10"><a href="spatdata.html#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb265-11"><a href="spatdata.html#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Year 2017 EBIRD observations of YUJA in Yucatán state&quot;</span>)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
</div>
</div>
<div id="joint-operations-with-raster-and-vector-data-i-masking-a-raster-with-a-polygon" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Joint Operations with Raster and Vector data I: Masking a Raster with a Polygon</h2>
<p>In the previous section, we saw an example of a geometric operation
between two vector spatial features—the intersection between
polygons and points.</p>
<p>Another class of important operations are those involving
raster data and vector data.</p>
<p>Suppose that we want to make a plot of the BioClim variables that
only includes the state of Yucatán.</p>
<p>The way this is typically done is to <em>mask</em> a raster using the
shape of the polygon for the state of Yucatán.</p>
<p>The ‘terra’ package offers the <code>mask()</code> function for this operation.
You can think of it as a sort or intersection between the raster and the
polygon: all the raster cells inside the polygon stay the same avlue, and all the
rest get the value <code>NA</code>.</p>
<p>The function <code>terra::mask()</code> uses R’s S4 system for deciding how to behave.
Its first argument, <code>x</code> is a raster that you want to mask, and when its
second argument, <code>mask</code>, is of type <code>SpatVector</code>, it uses that <code>SpatVector</code> to
to mask the raster.</p>
<p>A <code>SpatVector</code> is a data type used by the package ‘terra.’ It can be thought of
as an alternative way of storing spatial vector data, and ‘sf’ objects (like
<code>yuc_boundary</code>) can be converted into a <code>SpatVector</code> using ’terra’s <code>vect()</code> function,
like <code>vect(yuc_boundary)</code>.</p>
<p>Making a new raster by masking is as easy as:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="spatdata.html#cb266-1" aria-hidden="true" tabindex="-1"></a>yuc_masked_bioc <span class="ot">&lt;-</span> <span class="fu">mask</span>(</span>
<span id="cb266-2"><a href="spatdata.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> yuc_bioc,</span>
<span id="cb266-3"><a href="spatdata.html#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mask =</span> <span class="fu">vect</span>(yuc_boundary)</span>
<span id="cb266-4"><a href="spatdata.html#cb266-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>And we can plot that to see what it looks like:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="spatdata.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yuc_masked_bioc)</span></code></pre></div>
<p><img src="merida-workshop-2022_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
</div>
<div id="joint-operations-with-raster-and-vector-data-ii-extracting-raster-values-at-a-set-of-spatial-points" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Joint Operations with Raster and Vector data II: Extracting raster values at a set of spatial points</h2>
<p>If you have sampled a boatload of birds across a large space, you might be interested in
extracting environmental data from the locations where they were sampled. Understanding
the environmental and climatic conditions where a species has been observed (versus where it
is not found) forms the basis for niche modeling and other types of inference.</p>
<p>Thus, <em>extracting</em> values of a raster cell that contains an individual spatial
point is an important task.</p>
<p>We will take a small example problem here: suppose that we wish to extract the
BioClim values at the point where every Yucatán Jay in <code>yuc_state_jays</code> was observed.
For this operation, we use the function <code>extract()</code> from the ‘terra’ package.</p>
<p>This also uses R’s S4 system of object orientiation. When you pass the <code>extract()</code> function
a SpatRaster as the first argument, and a <code>SpatVector</code> as the second argument, it returns the
values of the cells overlapped by the <code>SpatVector</code>. In the case of spatial points, this
returns a single value for each point.</p>
<p>Note that the ‘tidyr’ package also has a function called <code>extract()</code>, so it is wise to
always be explicit and use namespace addressing when you want ’terra’s <code>extract()</code> function,
i.e., call it <code>terra::extract()</code>.</p>
<p>When deployed like this, <code>extract()</code> returns a data frame with one row for
each bird observation. We turn it into a tibble so it prints nicely:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="spatdata.html#cb268-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">extract</span>(yuc_bioc, <span class="fu">vect</span>(yuc_state_jays)) <span class="sc">%&gt;%</span></span>
<span id="cb268-2"><a href="spatdata.html#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1,082 × 20
##       ID wc2.1_30s_bio_1 wc2.1_30s_bio_2
##    &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1     1            25.8            11.6
##  2     2           NaN             NaN  
##  3     3            25.8            14.0
##  4     4            25.8            11.6
##  5     5            25.5            13.0
##  6     6            25.8            14  
##  7     7            25.6            11.6
##  8     8            25.5            14.1
##  9     9            26.0            13.2
## 10    10            26.0            13.2
## # … with 1,072 more rows, and 17 more variables:
## #   wc2.1_30s_bio_3 &lt;dbl&gt;, wc2.1_30s_bio_4 &lt;dbl&gt;,
## #   wc2.1_30s_bio_5 &lt;dbl&gt;, wc2.1_30s_bio_6 &lt;dbl&gt;,
## #   wc2.1_30s_bio_7 &lt;dbl&gt;, wc2.1_30s_bio_8 &lt;dbl&gt;,
## #   wc2.1_30s_bio_9 &lt;dbl&gt;, wc2.1_30s_bio_10 &lt;dbl&gt;,
## #   wc2.1_30s_bio_11 &lt;dbl&gt;, wc2.1_30s_bio_12 &lt;dbl&gt;,
## #   wc2.1_30s_bio_13 &lt;dbl&gt;, wc2.1_30s_bio_14 &lt;dbl&gt;, …</code></pre>
<p>If you wanted to insert those results seamlessly into the original
simple features collection, with some nice tidyverse idioms, you could do like this:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="spatdata.html#cb270-1" aria-hidden="true" tabindex="-1"></a>jays_and_bioc <span class="ot">&lt;-</span> yuc_state_jays <span class="sc">%&gt;%</span></span>
<span id="cb270-2"><a href="spatdata.html#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(terra<span class="sc">::</span><span class="fu">extract</span>(yuc_bioc, <span class="fu">vect</span>(.)))</span>
<span id="cb270-3"><a href="spatdata.html#cb270-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-4"><a href="spatdata.html#cb270-4" aria-hidden="true" tabindex="-1"></a>jays_and_bioc</span></code></pre></div>
<pre><code>## Simple feature collection with 1082 features and 25 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -90.4 ymin: 19.99 xmax: -87.57 ymax: 21.59
## Geodetic CRS:  WGS 84
## # A tibble: 1,082 × 26
##        gbifID name    type   type_en postal
##  *      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; 
##  1 3297327310 Yucatán Estado State   YU    
##  2 3291491655 Yucatán Estado State   YU    
##  3 3289867554 Yucatán Estado State   YU    
##  4 3286797902 Yucatán Estado State   YU    
##  5 3284777960 Yucatán Estado State   YU    
##  6 3283999442 Yucatán Estado State   YU    
##  7 3243749415 Yucatán Estado State   YU    
##  8 3176970726 Yucatán Estado State   YU    
##  9 2795705902 Yucatán Estado State   YU    
## 10 2794893768 Yucatán Estado State   YU    
## # … with 1,072 more rows, and 21 more variables:
## #   geometry &lt;POINT [°]&gt;, ID &lt;dbl&gt;,
## #   wc2.1_30s_bio_1 &lt;dbl&gt;, wc2.1_30s_bio_2 &lt;dbl&gt;,
## #   wc2.1_30s_bio_3 &lt;dbl&gt;, wc2.1_30s_bio_4 &lt;dbl&gt;,
## #   wc2.1_30s_bio_5 &lt;dbl&gt;, wc2.1_30s_bio_6 &lt;dbl&gt;,
## #   wc2.1_30s_bio_7 &lt;dbl&gt;, wc2.1_30s_bio_8 &lt;dbl&gt;,
## #   wc2.1_30s_bio_9 &lt;dbl&gt;, wc2.1_30s_bio_10 &lt;dbl&gt;, …</code></pre>
</div>
<div id="spat_data_appendix" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Appendix: Obtaining and Reducing The Example Spatial Datasets</h2>
<p>We don’t want our teaching repository to be too large, so I
subsetted a few of our example data down to just the Yucatán region.
The process for doing this with the different data sets is shown here.</p>
<div id="raster-data" class="section level3" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Raster Data</h3>
<p>To get the environmental data, I used the ‘geodata’ package, which
makes it easy to download the data sets. Unfortunately, my computer
is old enough that one of the security certificates on it does now
allow direct downloading via R of the datasets, but the error message
it gave told me the URL for the data set, and I could download it
with my browser, then read it in. I use namespace addressing
(i.e., <code>package::function()</code>) to be explicit about which package
each of the functions is in.</p>
<div id="worldclim-data" class="section level4" number="6.7.1.1">
<h4><span class="header-section-number">6.7.1.1</span> Worldclim Data</h4>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="spatdata.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get worldclim data for mexico at 0.5 minutes</span></span>
<span id="cb272-2"><a href="spatdata.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails for me on Mac Mojave because of a certification issue.  Lame.</span></span>
<span id="cb272-3"><a href="spatdata.html#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="co">#mex_tmax &lt;- geodata::worldclim_country(</span></span>
<span id="cb272-4"><a href="spatdata.html#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  country = &quot;Mexico&quot;, </span></span>
<span id="cb272-5"><a href="spatdata.html#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  var = &quot;tmax&quot;, </span></span>
<span id="cb272-6"><a href="spatdata.html#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  res = 0.5, </span></span>
<span id="cb272-7"><a href="spatdata.html#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  path = &quot;/tmp&quot;</span></span>
<span id="cb272-8"><a href="spatdata.html#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb272-9"><a href="spatdata.html#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="spatdata.html#cb272-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the error from that showed me that the URL was:</span></span>
<span id="cb272-11"><a href="spatdata.html#cb272-11" aria-hidden="true" tabindex="-1"></a><span class="co"># https://biogeo.ucdavis.edu/data/worldclim/v2.1/tiles/iso/MEX_wc2.1_30s_tmax.tif</span></span>
<span id="cb272-12"><a href="spatdata.html#cb272-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-13"><a href="spatdata.html#cb272-13" aria-hidden="true" tabindex="-1"></a>mex_tmax <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;~/Downloads/MEX_wc2.1_30s_tmax.tif&quot;</span>)</span>
<span id="cb272-14"><a href="spatdata.html#cb272-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-15"><a href="spatdata.html#cb272-15" aria-hidden="true" tabindex="-1"></a><span class="co"># I used the same procedure to get the BioClim variables</span></span>
<span id="cb272-16"><a href="spatdata.html#cb272-16" aria-hidden="true" tabindex="-1"></a>mex_bioc <span class="ot">&lt;-</span>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;~/Downloads/MEX_wc2.1_30s_bio.tif&quot;</span>)</span></code></pre></div>
<p>Those rasters are very large. If we whittle it down to focus on
a smaller area, the files will be smaller. So, we focus only on the area
around the Yucatán Peninsula. To do this we define a latitude and
longitude <em>extent</em>, and then <code>crop()</code> the raster to that extent, using
functions from the ‘terra’ package.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="spatdata.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is the extent that includes the Yucatan Province.</span></span>
<span id="cb273-2"><a href="spatdata.html#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The ext() function can take lat/lon as</span></span>
<span id="cb273-3"><a href="spatdata.html#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="co"># xmin, xmax, ymin, ymax, as done here.</span></span>
<span id="cb273-4"><a href="spatdata.html#cb273-4" aria-hidden="true" tabindex="-1"></a>yp_extent <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">ext</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="sc">-</span><span class="fl">86.5</span>, <span class="fl">19.5</span>, <span class="fl">21.75</span> ))</span>
<span id="cb273-5"><a href="spatdata.html#cb273-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-6"><a href="spatdata.html#cb273-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-7"><a href="spatdata.html#cb273-7" aria-hidden="true" tabindex="-1"></a><span class="co"># now we crop the raster of all of Mexico down to just</span></span>
<span id="cb273-8"><a href="spatdata.html#cb273-8" aria-hidden="true" tabindex="-1"></a><span class="co"># a small part.</span></span>
<span id="cb273-9"><a href="spatdata.html#cb273-9" aria-hidden="true" tabindex="-1"></a>yp_tmax <span class="ot">&lt;-</span> <span class="fu">crop</span>(mex_tmax, yp_extent)</span>
<span id="cb273-10"><a href="spatdata.html#cb273-10" aria-hidden="true" tabindex="-1"></a>yp_bioc <span class="ot">&lt;-</span> <span class="fu">crop</span>(mex_bioc, yp_extent)</span></code></pre></div>
<p>Finally, we save just that small Yucatán part of the raster in
our repository here, so everyone can use it.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="spatdata.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data/spatial/worldclim&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb274-2"><a href="spatdata.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(yp_tmax, <span class="st">&quot;data/spatial/worldclim/yp_tmax.tif&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb274-3"><a href="spatdata.html#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(yp_bioc, <span class="st">&quot;data/spatial/worldclim/yp_bioc.tif&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="vector-data" class="section level3" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> Vector data</h3>
<div id="mexico-state-boundaries" class="section level4" number="6.7.2.1">
<h4><span class="header-section-number">6.7.2.1</span> Mexico State Boundaries</h4>
<p>For polygons and lines for countries, states, coastlines, etc., a
wonderful source is <a href="https://www.naturalearthdata.com/">Natural Earth Data</a>,
a beautiful, consistent, and open-source set of vector (and raster) data for
making beautiful maps.</p>
<p>There are several R packages that make it fairly easy to obtain the
Natural Earth data. In paricular, ‘rnaturalearth’ and ‘rnaturalearthdata.’
I obtained polygon data for the different Mexican states/provinces with this
command:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="spatdata.html#cb275-1" aria-hidden="true" tabindex="-1"></a>mex_states <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_states</span>(</span>
<span id="cb275-2"><a href="spatdata.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="st">&quot;mexico&quot;</span>,</span>
<span id="cb275-3"><a href="spatdata.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span></span>
<span id="cb275-4"><a href="spatdata.html#cb275-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>That command returns the contents of the shapefile as a simple features
object. Then we saved that to the repository as a shapefile.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="spatdata.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data/spatial/ne_mexico_states&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb276-2"><a href="spatdata.html#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(mex_states, <span class="at">dsn =</span> <span class="st">&quot;data/spatial/ne_mexico_states/ne_mexico_states.shp&quot;</span>, <span class="at">append=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="ne_resolutions" class="section level4" number="6.7.2.2">
<h4><span class="header-section-number">6.7.2.2</span> Yucatan coastline at different resolutions</h4>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="spatdata.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get coastline maps at different resolutions</span></span>
<span id="cb277-2"><a href="spatdata.html#cb277-2" aria-hidden="true" tabindex="-1"></a>sf_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb277-3"><a href="spatdata.html#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">res10 =</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_coastline</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>),</span>
<span id="cb277-4"><a href="spatdata.html#cb277-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">res50 =</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_coastline</span>(<span class="at">scale =</span> <span class="dv">50</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>),</span>
<span id="cb277-5"><a href="spatdata.html#cb277-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">res110 =</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_coastline</span>(<span class="at">scale =</span> <span class="dv">110</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb277-6"><a href="spatdata.html#cb277-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb277-7"><a href="spatdata.html#cb277-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-8"><a href="spatdata.html#cb277-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now, crop each of those coastlines to the part we want</span></span>
<span id="cb277-9"><a href="spatdata.html#cb277-9" aria-hidden="true" tabindex="-1"></a>sf_cropped <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb277-10"><a href="spatdata.html#cb277-10" aria-hidden="true" tabindex="-1"></a>  sf_dat,</span>
<span id="cb277-11"><a href="spatdata.html#cb277-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">st_crop</span>(</span>
<span id="cb277-12"><a href="spatdata.html#cb277-12" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb277-13"><a href="spatdata.html#cb277-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">91</span>, <span class="at">ymin =</span> <span class="fl">19.5</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">86.5</span>, <span class="at">ymax =</span> <span class="fl">21.75</span>)</span>
<span id="cb277-14"><a href="spatdata.html#cb277-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb277-15"><a href="spatdata.html#cb277-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb277-16"><a href="spatdata.html#cb277-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-17"><a href="spatdata.html#cb277-17" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sf_cropped<span class="sc">$</span>res10) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;High(ish) Res&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb277-18"><a href="spatdata.html#cb277-18" aria-hidden="true" tabindex="-1"></a>p50 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sf_cropped<span class="sc">$</span>res50) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Medium Res&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb277-19"><a href="spatdata.html#cb277-19" aria-hidden="true" tabindex="-1"></a>p110 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sf_cropped<span class="sc">$</span>res110) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Low Res&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb277-20"><a href="spatdata.html#cb277-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-21"><a href="spatdata.html#cb277-21" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p110, p50, p10, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb277-22"><a href="spatdata.html#cb277-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">filename =</span> <span class="st">&quot;images/5.0/vector-resolutions.svg&quot;</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">11</span>)</span>
<span id="cb277-23"><a href="spatdata.html#cb277-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-24"><a href="spatdata.html#cb277-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the full-resolution GSHHG for comparison</span></span>
<span id="cb277-25"><a href="spatdata.html#cb277-25" aria-hidden="true" tabindex="-1"></a>gshhg_full <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;~/Downloads/gshhg-shp-2.3.7/GSHHS_shp/f/GSHHS_f_L1.shp&quot;</span>) </span>
<span id="cb277-26"><a href="spatdata.html#cb277-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-27"><a href="spatdata.html#cb277-27" aria-hidden="true" tabindex="-1"></a><span class="co"># remove a couple of invalid geometries</span></span>
<span id="cb277-28"><a href="spatdata.html#cb277-28" aria-hidden="true" tabindex="-1"></a>gshhg_clean <span class="ot">&lt;-</span> gshhg_full <span class="sc">%&gt;%</span></span>
<span id="cb277-29"><a href="spatdata.html#cb277-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(., <span class="fu">st_is_valid</span>(.))</span>
<span id="cb277-30"><a href="spatdata.html#cb277-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-31"><a href="spatdata.html#cb277-31" aria-hidden="true" tabindex="-1"></a><span class="co"># now, crop that</span></span>
<span id="cb277-32"><a href="spatdata.html#cb277-32" aria-hidden="true" tabindex="-1"></a>gshhg_cropped <span class="ot">&lt;-</span> gshhg_clean <span class="sc">%&gt;%</span></span>
<span id="cb277-33"><a href="spatdata.html#cb277-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">91</span>, <span class="at">ymin =</span> <span class="fl">19.5</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">86.5</span>, <span class="at">ymax =</span> <span class="fl">21.75</span>))</span>
<span id="cb277-34"><a href="spatdata.html#cb277-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-35"><a href="spatdata.html#cb277-35" aria-hidden="true" tabindex="-1"></a><span class="co"># and plot it:</span></span>
<span id="cb277-36"><a href="spatdata.html#cb277-36" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gshhg_cropped) <span class="sc">+</span></span>
<span id="cb277-37"><a href="spatdata.html#cb277-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb277-38"><a href="spatdata.html#cb277-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb277-39"><a href="spatdata.html#cb277-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;GSHHG&quot;</span>) <span class="sc">+</span> </span>
<span id="cb277-40"><a href="spatdata.html#cb277-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb277-41"><a href="spatdata.html#cb277-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb277-42"><a href="spatdata.html#cb277-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;rect&quot;</span>,</span>
<span id="cb277-43"><a href="spatdata.html#cb277-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">87.5</span>,</span>
<span id="cb277-44"><a href="spatdata.html#cb277-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">86.5</span>,</span>
<span id="cb277-45"><a href="spatdata.html#cb277-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">21.25</span>,</span>
<span id="cb277-46"><a href="spatdata.html#cb277-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="fl">21.75</span>,</span>
<span id="cb277-47"><a href="spatdata.html#cb277-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb277-48"><a href="spatdata.html#cb277-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb277-49"><a href="spatdata.html#cb277-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb277-50"><a href="spatdata.html#cb277-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-51"><a href="spatdata.html#cb277-51" aria-hidden="true" tabindex="-1"></a>part <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gshhg_cropped) <span class="sc">+</span></span>
<span id="cb277-52"><a href="spatdata.html#cb277-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb277-53"><a href="spatdata.html#cb277-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb277-54"><a href="spatdata.html#cb277-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">87.5</span>, <span class="sc">-</span><span class="fl">86.5</span>),</span>
<span id="cb277-55"><a href="spatdata.html#cb277-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">21.25</span>, <span class="fl">21.75</span>)</span>
<span id="cb277-56"><a href="spatdata.html#cb277-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;GSHHG zoomed way in!&quot;</span>) <span class="sc">+</span> </span>
<span id="cb277-57"><a href="spatdata.html#cb277-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb277-58"><a href="spatdata.html#cb277-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-59"><a href="spatdata.html#cb277-59" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(full, part, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb277-60"><a href="spatdata.html#cb277-60" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g2, <span class="at">filename =</span> <span class="st">&quot;images/5.0/gshhg.svg&quot;</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">8</span>)</span></code></pre></div>
</div>
<div id="yucatán-municipality-boundaries" class="section level4" number="6.7.2.3">
<h4><span class="header-section-number">6.7.2.3</span> Yucatán Municipality Boundaries</h4>
<p>A quick web-search found an open-source data set with municipalies
archived at New York University:
<a href="https://archive.nyu.edu/bitstream/2451/37132/1/nyu_2451_37132.zip">https://archive.nyu.edu/bitstream/2451/37132/1/nyu_2451_37132.zip</a></p>
<p>This is a small file that I downloaded and then put into the
repo with the name <code>yuc_municipio</code>. It can be loaded like this:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="spatdata.html#cb278-1" aria-hidden="true" tabindex="-1"></a>yuc_muni <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/spatial/yuc_municipio/yuc_municipio.shp&quot;</span>)</span></code></pre></div>
<p>We didn’t end up using this in this session/notebook, but it
is a fun data set if you want to play with it. Here is something
to try: count up how many jay observations there were in each of the
municipalities.</p>
</div>
</div>
<div id="species-occurrence-data" class="section level3" number="6.7.3">
<h3><span class="header-section-number">6.7.3</span> Species Occurrence Data</h3>
<div id="yucatan-jay-occurrences-1" class="section level4" number="6.7.3.1">
<h4><span class="header-section-number">6.7.3.1</span> Yucatan Jay Occurrences</h4>
<p>These data were download from <a href="https://www.gbif.org/">https://www.gbif.org/</a> and
searched for the species “Yucatan Jay.” This returns one result which links to the
<a href="https://www.gbif.org/species/2482574">page</a> for the data set. I downloaded in
and then gzipped it and saved it into <code>data/spatial</code>.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="envdata.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="geassoc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/eriqande/merida-workshop-2022/edit/master/5.0-visualizing-spatial-data.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/eriqande/merida-workshop-2022/commits/master/5.0-visualizing-spatial-data.Rmd",
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["merida-workshop-2022.pdf", "merida-workshop-2022.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
