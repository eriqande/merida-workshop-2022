[["index.html", "Reproducible Research for Conservation  Mérida, Mexico Preface", " Reproducible Research for Conservation  Mérida, Mexico Eric C. Anderson, Christen Bossu, Richard Evan Feldman, Kristen C. Ruegg, Marius Somveille 2021-12-08 Preface This is the site/book associated with a course scheduled for January 2022. More on this later "],["congen-intro.html", "Session 1 Introduction to Conservation Genomics Approaches", " Session 1 Introduction to Conservation Genomics Approaches Something here. "],["introduction-to-the-tidyverse.html", "Session 2 Introduction to the tidyverse", " Session 2 Introduction to the tidyverse Load required packages library(tidyverse) library(viridis) #preferred color palette for graphing ## Loading required package: viridisLite Import bird data. The data provides information on the species richness of birds and butterflies and NDVI at 30 sites. Our goal is to run a linear model that estimates the magnitude, direction, and uncertainty in the species richness-NDVI relationship for each taxa and then visualize the relationship. data.all&lt;-read_csv(&quot;data/data.richard.new.csv&quot;) ## New names: ## * `` -&gt; ...1 ## Rows: 60 Columns: 5 ## -- Column specification ------------------------------- ## Delimiter: &quot;,&quot; ## chr (2): Site, Taxa ## dbl (3): ...1, NDVI, Richness ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. data.all ## # A tibble: 60 x 5 ## ...1 Site NDVI Taxa Richness ## &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 1 Site.1 0.66 Birds 14 ## 2 2 Site.2 0.4 Birds 10 ## 3 3 Site.3 0.36 Birds 9 ## 4 4 Site.4 0.82 Birds 16 ## 5 5 Site.5 0.55 Birds 12 ## 6 6 Site.6 0.29 Birds 7 ## 7 7 Site.7 0.51 Birds 11 ## 8 8 Site.8 0.74 Birds 16 ## 9 9 Site.9 1 Birds 25 ## 10 10 Site.10 0.76 Birds 16 ## # ... with 50 more rows The old way is to run a model on each taxa separately: model.birds&lt;-lm(Richness~NDVI, data=data.all[data.all$Taxa==&quot;Birds&quot;,]) #subset the Birds data model.butterflies&lt;-lm(Richness~NDVI, data=data.all[data.all$Taxa==&quot;Butterflies&quot;,]) #subset the Butterflies Extracting results from the summary file is not easy. key.results.birds&lt;-as.data.frame(summary(model.birds)[[4]]) #You have to remember that subscript [[4]] corresponds to the main results The broom package presents model results in a tidy way. library(broom) broom::tidy() returns parameter estimates. birds.tidy&lt;-model.birds%&gt;%tidy() birds.tidy ## # A tibble: 2 x 5 ## term estimate std.error statistic p.value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 (Intercept) 0.952 1.22 0.780 4.42e- 1 ## 2 NDVI 19.9 1.77 11.2 6.75e-12 broom::glance() includes R2, AIC, and more. birds.glance&lt;-model.birds%&gt;%glance() birds.glance ## # A tibble: 1 x 12 ## r.squared adj.r.squared sigma statistic p.value ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 0.819 0.812 1.70 127. 6.75e-12 ## # ... with 7 more variables: df &lt;dbl&gt;, logLik &lt;dbl&gt;, ## # AIC &lt;dbl&gt;, BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, ## # df.residual &lt;int&gt;, nobs &lt;int&gt; broom::augment() returns fitted values birds.augment&lt;-model.birds%&gt;%augment() birds.augment ## # A tibble: 30 x 8 ## Richness NDVI .fitted .resid .hat .sigma .cooksd ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 14 0.66 14.1 -0.0743 0.0334 1.73 3.41e-5 ## 2 10 0.4 8.91 1.09 0.111 1.72 2.90e-2 ## 3 9 0.36 8.11 0.890 0.136 1.72 2.49e-2 ## 4 16 0.82 17.3 -1.26 0.0583 1.71 1.79e-2 ## 5 12 0.55 11.9 0.113 0.0484 1.73 1.17e-4 ## 6 7 0.29 6.72 0.282 0.188 1.73 3.90e-3 ## 7 11 0.51 11.1 -0.0920 0.0603 1.73 9.98e-5 ## 8 16 0.74 15.7 0.335 0.0389 1.73 8.18e-4 ## 9 25 1 20.8 4.17 0.152 1.50 6.35e-1 ## 10 16 0.76 16.1 -0.0625 0.0425 1.73 3.12e-5 ## # ... with 20 more rows, and 1 more variable: ## # .std.resid &lt;dbl&gt; To run models or implement any function on the different groups within a data frame, one must master tidyr::nest() and purrr::map(). nest() creates a list of data frames with each corresponding to a different group. Example: create a data frame for each taxa. data.taxa&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest() data.taxa ## # A tibble: 2 x 2 ## # Groups: Taxa [2] ## Taxa data ## &lt;chr&gt; &lt;list&gt; ## 1 Birds &lt;tibble [30 x 4]&gt; ## 2 Butterflies &lt;tibble [30 x 4]&gt; The grouping variable is left out of the nested data frame. All other data is now in a separate data frame, nested with the whole data frame. You can inspect what lies behind the data column by using unnest() to display the original data. data.original.birds&lt;-data.taxa%&gt;%ungroup()%&gt;%slice(n=1)%&gt;%unnest(data) #slice(n=1) means extract the first row of the data.taxa data frame. data.original.birds ## # A tibble: 30 x 5 ## Taxa ...1 Site NDVI Richness ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Birds 1 Site.1 0.66 14 ## 2 Birds 2 Site.2 0.4 10 ## 3 Birds 3 Site.3 0.36 9 ## 4 Birds 4 Site.4 0.82 16 ## 5 Birds 5 Site.5 0.55 12 ## 6 Birds 6 Site.6 0.29 7 ## 7 Birds 7 Site.7 0.51 11 ## 8 Birds 8 Site.8 0.74 16 ## 9 Birds 9 Site.9 1 25 ## 10 Birds 10 Site.10 0.76 16 ## # ... with 20 more rows map() applies a function to each nested data frame. Example: find the mean number of species of each taxa mean.taxa&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(mean.Richness=map(data, function(x)mean(x%&gt;%pull(Richness)))) #map indicates the data frame column with the nested data (i.e., data) and applies a function to that data. #data becomes the &quot;x&quot; in the function. #pull() extracts the variable of interest and returns a vector. mean.taxa ## # A tibble: 2 x 3 ## # Groups: Taxa [2] ## Taxa data mean.Richness ## &lt;chr&gt; &lt;list&gt; &lt;list&gt; ## 1 Birds &lt;tibble [30 x 4]&gt; &lt;dbl [1]&gt; ## 2 Butterflies &lt;tibble [30 x 4]&gt; &lt;dbl [1]&gt; The results are mutated as another list column in the original data frame. They can be unnested. mean.taxa&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(mean.Richness=map(data, function(x)mean(x%&gt;%pull(Richness))))%&gt;%unnest(mean.Richness) mean.taxa ## # A tibble: 2 x 3 ## # Groups: Taxa [2] ## Taxa data mean.Richness ## &lt;chr&gt; &lt;list&gt; &lt;dbl&gt; ## 1 Birds &lt;tibble [30 x 4]&gt; 14.2 ## 2 Butterflies &lt;tibble [30 x 4]&gt; 10.7 More complicated functions are easier to specify outside of the pipe. Example: find the sites with the highest and lowest bird and butterfly species richness get.sites&lt;-function(x){ #Each element of the list column data will correspond to data frame &quot;x&quot; in the function. x%&gt;%filter(Richness%in%c(max(Richness), min(Richness)))%&gt;%mutate(Type=ifelse(Richness==max(Richness), &quot;High&quot;, &quot;Low&quot;))%&gt;%arrange(desc(Richness)) } sites.taxa&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(Types=map(data, get.sites))%&gt;%unnest(Types)%&gt;%select(-data) #The function get.sites is applied to each element in the list column data. sites.taxa ## # A tibble: 4 x 6 ## # Groups: Taxa [2] ## Taxa ...1 Site NDVI Richness Type ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 Birds 9 Site.9 1 25 High ## 2 Birds 6 Site.6 0.29 7 Low ## 3 Butterflies 48 Site.18 0.81 20 High ## 4 Butterflies 32 Site.2 0.4 6 Low Another example, this time nesting the data based on sites and finding whether a site has more bird or butterfly species. get.taxa&lt;-function(x){ Top.taxa&lt;-x%&gt;%filter(Richness==max(Richness))%&gt;%pull(Taxa) if(length(Top.taxa)&gt;1){paste(Top.taxa[1], Top.taxa[2], sep=&quot; + &quot;)}else{Top.taxa} #Need to indicate sites where birds and butterflies have the same species richness } sites.richness&lt;-data.all%&gt;%group_by(Site)%&gt;%nest()%&gt;%mutate(Animal=map(data, get.taxa))%&gt;%unnest(Animal)%&gt;%select(-data) sites.richness ## # A tibble: 30 x 2 ## # Groups: Site [30] ## Site Animal ## &lt;chr&gt; &lt;chr&gt; ## 1 Site.1 Birds ## 2 Site.2 Birds ## 3 Site.3 Birds ## 4 Site.4 Birds ## 5 Site.5 Birds ## 6 Site.6 Butterflies ## 7 Site.7 Birds ## 8 Site.8 Birds ## 9 Site.9 Birds ## 10 Site.10 Birds ## # ... with 20 more rows Are there any sites where birds and butterflies have equal species richness? site.animals&lt;-sites.richness%&gt;%filter(Animal==&quot;Birds + Butterflies&quot;) site.animals ## # A tibble: 1 x 2 ## # Groups: Site [1] ## Site Animal ## &lt;chr&gt; &lt;chr&gt; ## 1 Site.25 Birds + Butterflies Are there more sites with higher bird or butterfly species richness? richness.summary&lt;-sites.richness%&gt;%group_by(Animal)%&gt;%summarize(No.Sites=n()) richness.summary ## # A tibble: 3 x 2 ## Animal No.Sites ## &lt;chr&gt; &lt;int&gt; ## 1 Birds 26 ## 2 Birds + Butterflies 1 ## 3 Butterflies 3 Run a linear model to estimate the relationship between NDVI and richness for each taxa. lm can be specified as a function in map(). The model is mutated as a list column. We can mutate all model results by mapping tidy, glance, and augument onto each model. richness.models&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(Models=map(data, ~lm(Richness~NDVI, data=.)))%&gt;%mutate(Tidied=map(Models, tidy), Glanced=map(Models, glance), Augmented=map(Models, augment)) richness.models ## # A tibble: 2 x 6 ## # Groups: Taxa [2] ## Taxa data Models Tidied Glanced Augmented ## &lt;chr&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; ## 1 Birds &lt;tibbl~ &lt;lm&gt; &lt;tibbl~ &lt;tibble~ &lt;tibble ~ ## 2 Butterflies &lt;tibbl~ &lt;lm&gt; &lt;tibbl~ &lt;tibble~ &lt;tibble ~ Is NDVI more strongly associated with bird or butterfly species richness? Lets compare the parameter estimates and their precision, which can be returned as a 95% confidence interval by specifying conf.int=TRUE and conf.level=0.95 (the default). richness.models&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(Models=map(data, ~lm(Richness~NDVI, data=.)))%&gt;%mutate(Tidied=map(Models, tidy, conf.int=TRUE), Glanced=map(Models, glance), Augmented=map(Models, augment))%&gt;%unnest(Tidied) parameter.estimates&lt;-richness.models%&gt;%select(Taxa, term, estimate, conf.low, conf.high)%&gt;%filter(term==&quot;NDVI&quot;) parameter.estimates ## # A tibble: 2 x 5 ## # Groups: Taxa [2] ## Taxa term estimate conf.low conf.high ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Birds NDVI 19.9 16.3 23.5 ## 2 Butterflies NDVI 12.7 8.91 16.4 Graph the results: compare the relationship with NDVI for both species. Rather than use the fitted values, predict richness for all NDVI values from 0 to 1 at intervals of 0.01. The precision of the prediction can be estimated as confidence intervals (interval=confidence) or prediction intervals (interval=prediction) richness.models&lt;-data.all%&gt;%group_by(Taxa)%&gt;%nest()%&gt;%mutate(Models=map(data, ~lm(Richness~NDVI, data=.)))%&gt;%mutate(Tidied=map(Models, tidy, conf.int=TRUE), Glanced=map(Models, glance), Predictions=map(Models, augment, newdata=tibble(NDVI=seq(0,1,0.01)), se_fit=TRUE, interval=&quot;confidence&quot;)) #Rather than use the original NDVI values for prediction, specify a new data frame (newdata) with the NDVI values of interest richness.predictions&lt;-richness.models%&gt;%unnest(Predictions)%&gt;%select(Taxa, NDVI, .fitted, .lower, .upper)%&gt;%rename(Richness=.fitted, low.95=.lower, high.95=.upper) p&lt;-ggplot(richness.predictions,aes(x=NDVI, y=Richness, col=Taxa)) + geom_line(size=2) p&lt;-p+geom_ribbon(aes(ymin=low.95, ymax=high.95, fill=Taxa), show.legend=FALSE, color=NA, alpha=0.3) #Visualize confidence interval p&lt;-p+geom_point(data=data.all, aes(x=NDVI, y=Richness, col=Taxa), size=3) #Add original data p&lt;-p+scale_y_continuous(name=&quot;Species richness\\n&quot;) p&lt;-p+scale_x_continuous(name=&quot;\\nNDVI&quot;) p&lt;-p+scale_color_viridis_d() p&lt;-p+scale_fill_viridis_d() p&lt;-p+theme_classic()+ theme(axis.line.x=element_line(colour=&quot;black&quot;), axis.line.y=element_line(colour=&quot;black&quot;), text = element_text(size=12)) p ggsave(&quot;Richness_vs_NDVI.pdf&quot;, device=&quot;pdf&quot;, width=6, height=3, units=&quot;in&quot;, dpi=600) "],["reporg.html", "Session 3 Organizing Research Projects for Reproducibility 3.1 RStudio and RStudio Projects 3.2 Version control with git 3.3 GitHub 3.4 Big or Private data sets 3.5 Merge Conflicts? 3.6 Explain caching", " Session 3 Organizing Research Projects for Reproducibility Intro verbiage. 3.1 RStudio and RStudio Projects Directory structure, data, R, etc. numbering scripts. README.Rmd 3.2 Version control with git What you do and dont want to keep under version control. .gitignore, etc. 3.3 GitHub Boing! 3.4 Big or Private data sets Check out the googledrive package. 3.5 Merge Conflicts? Working together on this bookdown means we will get merge conflicts. 3.6 Explain caching for(i in 1:10) { r &lt;- runif(1e08) } silly &lt;- r[1:10] rm(r) "],["envdata.html", "Session 4 Finding and Obtaining Environmental Data for Conservation 4.1 Environmental Layers. A general overview", " Session 4 Finding and Obtaining Environmental Data for Conservation Types of environmental data: direcly observed (satellite data) Interpolated or modeled etc. Discussion of CRSs. 4.1 Environmental Layers. A general overview This section provides a brief narrative of Marius Someveilles PowerPoint presentation. We are trying to succinctly capture the main points in this web/bookdown version so that it might easily be translated with Google Translate. Environmental layers in this context are raster data they carry information about particular cells or pixels of the earths surface. All of these terms will be defined in detail later. For now, here are a few pictures of what environmental layers might look like when they are plotted and displayed: 4.1.1 Environmental layers in conservation genetics 4.1.1.1 Landscape connectivity analysis (gene flow) Connectivity is essential for long term persistence of populations and metapopulations as it affects gene flow. Functional connectivity is the degree to which individuals move through a landscape, which is affected by landscape features and environmental heterogeneity. Landscape genetics tests which landscape and environmental factors best explain genetic connectivity among populations and highlights which landscape features need to be maintained or enhanced to facilitate connectivity (gene flow) for different species. For example, Robertson et al. (2018) studied frogs in multiple locations in North America, shown here: The positions of samples are shown here on a map that was created from land cover data. However, many other layers area available, giving information of, for example, topography, temperature, and moisture levels in the different locations. Landscape genetics approaches were used to identify which of these features were most associated with connectivity between populations in each of the different regions (i.e, different colors on the map). They summarized those results as follows: 4.1.1.2 Environmental Niche Analysis Ruegg et al. (2021) shows another example of the use of environmental layers in conservation genetics. In this case, genetic differences resolved separate breeding populations of the willow flycatcher in North America, and also made it possible to identify where birds from each breeding population spend their winters, as shown in the following figure (in which the different breeding populations are denoted by different colors): With the breeding and wintering areas for each subpopulation identified, other environmental layers (not shown) were used to identify the environmental and climatic conditions that defined the birds breeding and wintering niches for the subpopulations. Population trends were found to be associated with overlap between breeding and wintering niches, with the subpopulation showing the least niche overlap being the only subpopulation not showing a decreasing trend. 4.1.1.3 Genome-environment association to study vulnerability Associations between genetic variation and environmental variation (that we will hear about from Christen Bossu!) can be used to identify places where there is expected to be a mismatch between expected genetic patterns and environmental conditions after changes due to climate change. One of the first papers documenting this was Bay et al. (2018). In their study, a variety of environmental predictors (BIO18, BIO15, etc.), whose values across space are represented by environmental layer data, were found to be associated with genetic variation, as shown in the following montage of figures from the paper: 4.1.2 Environmental layers as raster data 4.1.3 Coordinate system and projections 4.1.4 Parameters of raster data 4.1.5 Examples of climate layers Source Method Variables Extent Spatial resolution Temporal resolution WorldClim Interpolation of observations from weather stations Temperature Precipitation Solar radiation BIOCLIM Global 30 sec (~1km2) 2.5 min 5 min 10 min (~340 km2) Monthly 1970  2000 Chelsa Quasi-mechanistical downscale of global circulation model Temperature Precipitation BIOCLIM Global 30 arc sec (~1km2) Monthly 1979  2018 Prism Statistical model using weather station data and atmospheric process Temperature Precipitation USA 30 arc sec (~1km2) Monthly 19812010 4.1.6 Examples of atmospheric layers Source Method Variables Extent Spatial resolution Temporal resolution NOAA Global Forecast System Global atmospheric model Wind direction Wind speed Global 0.5 deg 6 times / day 2011  present WorldClim Interpolation of observations from weather stations Wind speed Water vapor pressure Global 30 sec (~1km2) 2.5 min 5 min 10 min (~340 km2) Monthly 1970  2000 4.1.7 Examples of vegetation layers Source Method Variables Extent Spatial resolution Temporal resolution VIP30 (NASA) Remote sensing using spectrometer on board satellites NDVI EVI Global 0.05 deg ~5.6km Monthly 1981  2014 Copernicus (ESA) Remote sensing using spectrometer on board satellites NDVI EVI Global 300m 10-day Present GEDI (NASA) Remote sensing using lidar (laser ranging) onboard the ISS Vertical profile of vegetation: canopy height, canopy vertical structure, ground elevation 51.6 deg N and S latitudes 25m Annual Present 4.1.8 Examples of landscape layers Source Method Variables Extent Spatial resolution Temporal resolution SRTM (NASA) Remote sensing using radar onboard satellites Elevation Global 1 arc-second (~30m) NA MODIS (NASA) Remote sensing using spectrometer onboard satellites Snow cover Global 30 arc-sec (~1km2) Copernicus (ESA) remote sensing + random forest for classification Land cover Global 100m NA NASA Gridded Population of the World Input data are census tables Human population density Global 30 arc-sec (~1km2) NA 20002020 References Bay RA, Harrigan RJ, Le Underwood V et al. (2018) Genomic signals of selection predict climate-driven population declines in a migratory bird. Science, 359, 8386. Robertson JM, Murphy MA, Pearl CA et al. (2018) Regional variation in drivers of connectivity for two frog species (rana pretiosa and r. Luteiventris) from the US pacific northwest. Molecular ecology, 27, 32423256. Ruegg K, Anderson EC, Somveille M et al. (2021) Linking climate niches across seasons to assess population vulnerability in a migratory bird. Global Change Biology. "],["spatdata.html", "Session 5 Handling and Visualizing Spatial Data in R", " Session 5 Handling and Visualizing Spatial Data in R Stuff here. Marius and I brainstormed on this. We will do an example that involves the Yucatan Jay (or, better yet, ask Richard if a more interesting/iconic species is available). ECA has downloaded occurrences from GBIF (3 Mb compressed) and has put them into data. We can use that and some of the raster data and some vector data to do a little exploration of how to use the sf package in combination with ggplot2. Also, some filtering in the tidyverse. Ideas: Do some filtering of the data set (tidyverse reprise) Talk about lubridate for dealing with dates and times facet wrap over months to look at occurrences, etc. Some very light geometrical operations, for example get all the observations within X km of some features (like highways). Explore the use of different raster backgrounds. "],["conclude.html", "Session 6 Concluding Remarks / Parting Words", " Session 6 Concluding Remarks / Parting Words Something here. Bay RA, Harrigan RJ, Le Underwood V et al. (2018) Genomic signals of selection predict climate-driven population declines in a migratory bird. Science, 359, 8386. Robertson JM, Murphy MA, Pearl CA et al. (2018) Regional variation in drivers of connectivity for two frog species (rana pretiosa and r. Luteiventris) from the US pacific northwest. Molecular ecology, 27, 32423256. Ruegg K, Anderson EC, Somveille M et al. (2021) Linking climate niches across seasons to assess population vulnerability in a migratory bird. Global Change Biology. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
